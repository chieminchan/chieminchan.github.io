<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ğŸŒµ ES6 | CHIEMINCHAN&#39;S BLOG</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/donut.png">
    <meta name="description" content="Hi, glad you came.">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.42c8c4d7.js" as="script"><link rel="preload" href="/assets/js/2.fefa3fa1.js" as="script"><link rel="preload" href="/assets/js/1.67a15f5a.js" as="script"><link rel="preload" href="/assets/js/74.adc93296.js" as="script"><link rel="prefetch" href="/assets/js/10.5229b01a.js"><link rel="prefetch" href="/assets/js/11.9dccb5a1.js"><link rel="prefetch" href="/assets/js/12.1aa023e7.js"><link rel="prefetch" href="/assets/js/13.da540175.js"><link rel="prefetch" href="/assets/js/14.981e669d.js"><link rel="prefetch" href="/assets/js/15.f28dd0b3.js"><link rel="prefetch" href="/assets/js/16.47e1d84d.js"><link rel="prefetch" href="/assets/js/17.7ff34030.js"><link rel="prefetch" href="/assets/js/18.6dcbdd16.js"><link rel="prefetch" href="/assets/js/19.e568fd00.js"><link rel="prefetch" href="/assets/js/20.182f1f9b.js"><link rel="prefetch" href="/assets/js/21.b834a74a.js"><link rel="prefetch" href="/assets/js/22.9fc3ed2b.js"><link rel="prefetch" href="/assets/js/23.3193a727.js"><link rel="prefetch" href="/assets/js/24.de705b4a.js"><link rel="prefetch" href="/assets/js/25.5480b043.js"><link rel="prefetch" href="/assets/js/26.e90c8d2c.js"><link rel="prefetch" href="/assets/js/27.368adf8d.js"><link rel="prefetch" href="/assets/js/28.02977665.js"><link rel="prefetch" href="/assets/js/29.b5ba0958.js"><link rel="prefetch" href="/assets/js/3.fc739620.js"><link rel="prefetch" href="/assets/js/30.8162d43f.js"><link rel="prefetch" href="/assets/js/31.ea0eb311.js"><link rel="prefetch" href="/assets/js/32.bd05dede.js"><link rel="prefetch" href="/assets/js/33.4f7ad3d8.js"><link rel="prefetch" href="/assets/js/34.01a9933e.js"><link rel="prefetch" href="/assets/js/35.9b698963.js"><link rel="prefetch" href="/assets/js/36.aa7c6634.js"><link rel="prefetch" href="/assets/js/37.3c8b825d.js"><link rel="prefetch" href="/assets/js/38.3ec434b4.js"><link rel="prefetch" href="/assets/js/39.abebd645.js"><link rel="prefetch" href="/assets/js/4.0471e9ae.js"><link rel="prefetch" href="/assets/js/40.a3e43d3c.js"><link rel="prefetch" href="/assets/js/41.8e20a250.js"><link rel="prefetch" href="/assets/js/42.1898fb9e.js"><link rel="prefetch" href="/assets/js/43.005c2795.js"><link rel="prefetch" href="/assets/js/44.dd7c81da.js"><link rel="prefetch" href="/assets/js/45.f5c6d4e0.js"><link rel="prefetch" href="/assets/js/46.2c6f3510.js"><link rel="prefetch" href="/assets/js/47.cfea7eed.js"><link rel="prefetch" href="/assets/js/48.c05e643b.js"><link rel="prefetch" href="/assets/js/49.e92cd5e4.js"><link rel="prefetch" href="/assets/js/5.5356be46.js"><link rel="prefetch" href="/assets/js/50.70ee95d8.js"><link rel="prefetch" href="/assets/js/51.55091923.js"><link rel="prefetch" href="/assets/js/52.05579c1d.js"><link rel="prefetch" href="/assets/js/53.5ed1d655.js"><link rel="prefetch" href="/assets/js/54.957c1ce9.js"><link rel="prefetch" href="/assets/js/55.4da64e6c.js"><link rel="prefetch" href="/assets/js/56.b52c1fe8.js"><link rel="prefetch" href="/assets/js/57.d0d920bc.js"><link rel="prefetch" href="/assets/js/58.ef3aaeb1.js"><link rel="prefetch" href="/assets/js/59.6c218857.js"><link rel="prefetch" href="/assets/js/6.5b3d5499.js"><link rel="prefetch" href="/assets/js/60.c34ee7fd.js"><link rel="prefetch" href="/assets/js/61.1c2759ef.js"><link rel="prefetch" href="/assets/js/62.89046da1.js"><link rel="prefetch" href="/assets/js/63.237796ed.js"><link rel="prefetch" href="/assets/js/64.a4043fbd.js"><link rel="prefetch" href="/assets/js/65.862ba07d.js"><link rel="prefetch" href="/assets/js/66.af9362a9.js"><link rel="prefetch" href="/assets/js/67.067fa5e1.js"><link rel="prefetch" href="/assets/js/68.114d907c.js"><link rel="prefetch" href="/assets/js/69.8a2b6aab.js"><link rel="prefetch" href="/assets/js/7.c94df317.js"><link rel="prefetch" href="/assets/js/70.2c7a1579.js"><link rel="prefetch" href="/assets/js/71.9c53f57f.js"><link rel="prefetch" href="/assets/js/72.3b58f513.js"><link rel="prefetch" href="/assets/js/73.980cd2c1.js"><link rel="prefetch" href="/assets/js/75.2d57b228.js"><link rel="prefetch" href="/assets/js/76.0cc54ebf.js"><link rel="prefetch" href="/assets/js/77.64ccf4c4.js"><link rel="prefetch" href="/assets/js/78.d4bcdcae.js"><link rel="prefetch" href="/assets/js/79.69bd54c2.js"><link rel="prefetch" href="/assets/js/80.ebafbba2.js"><link rel="prefetch" href="/assets/js/81.ba0c73cf.js"><link rel="prefetch" href="/assets/js/82.d339905d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.934ed2fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">CHIEMINCHAN'S BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/articles/" class="nav-link">
  æ–‡ç« 
</a></div><div class="nav-item"><a href="/fragments/" class="nav-link router-link-active">
  çŸ¥è¯†ç¢ç‰‡
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  è¯»/è§‚åæ„Ÿ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chieminchan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubé¦–é¡µ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/articles/" class="nav-link">
  æ–‡ç« 
</a></div><div class="nav-item"><a href="/fragments/" class="nav-link router-link-active">
  çŸ¥è¯†ç¢ç‰‡
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  ç®—æ³•
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  è¯»/è§‚åæ„Ÿ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chieminchan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubé¦–é¡µ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>çŸ¥è¯†ç¢ç‰‡</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fragments/" aria-current="page" class="sidebar-link">ğŸŒ» çŸ¥è¯†ç¢ç‰‡</a></li><li><a href="/fragments/Vue.html" class="sidebar-link">ğŸŒµ Vue</a></li><li><a href="/fragments/React.html" class="sidebar-link">ğŸŒµ React</a></li><li><a href="/fragments/Network.html" class="sidebar-link">ğŸŒµ ç½‘ç»œ</a></li><li><a href="/fragments/JavaScript.html" class="sidebar-link">ğŸŒµ JavaScript</a></li><li><a href="/fragments/JavaScript Algorithms.html" class="sidebar-link">ğŸŒµ JavaScript åŸºç¡€ç®—æ³•</a></li><li><a href="/fragments/ES6.html" aria-current="page" class="active sidebar-link">ğŸŒµ ES6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_001-varã€-let-åŠ-const-åŒºåˆ«" class="sidebar-link">001ï¼š varã€ let åŠ const åŒºåˆ«ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_002-ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«" class="sidebar-link">002ï¼š ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_003-set-å’Œ-weaksetã€map-å’Œ-weakmap-åŒºåˆ«" class="sidebar-link">003ï¼š Set å’Œ WeakSetã€Map å’Œ WeakMap åŒºåˆ«ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_004-class-å’Œæ™®é€šæ„é€ å‡½æ•°çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="sidebar-link">004ï¼š Class å’Œæ™®é€šæ„é€ å‡½æ•°çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_005-class-ä¸­çš„-this-æŒ‡å‘" class="sidebar-link">005ï¼š Class ä¸­çš„ this æŒ‡å‘</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_006-class-ä¸­çš„-super-ç”¨æ³•" class="sidebar-link">006ï¼š Class ä¸­çš„ super ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_007-es6-çš„-class-ç»§æ‰¿å’Œ-es5-çš„ç»§æ‰¿åŒºåˆ«" class="sidebar-link">007ï¼š ES6 çš„ Class ç»§æ‰¿å’Œ ES5 çš„ç»§æ‰¿åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_008-symbol-ç”¨æ³•å’Œåº”ç”¨åœºæ™¯" class="sidebar-link">008ï¼š Symbol ç”¨æ³•å’Œåº”ç”¨åœºæ™¯</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_009-promise-all-çš„ç”¨æ³•ã€é”™è¯¯å¤„ç†ã€ä»¥åŠæ‰‹å†™åŸç†å®ç°" class="sidebar-link">009ï¼š Promise.all çš„ç”¨æ³•ã€é”™è¯¯å¤„ç†ã€ä»¥åŠæ‰‹å†™åŸç†å®ç°</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_010-promise-allsettled-çš„ç”¨æ³•ä»¥åŠæ‰‹å†™åŸç†å®ç°" class="sidebar-link">010ï¼š Promise.allSettled çš„ç”¨æ³•ä»¥åŠæ‰‹å†™åŸç†å®ç°</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_011-promise-ä¸²è¡Œå’Œå¹¶è¡Œçš„å®ç°" class="sidebar-link">011ï¼š Promise ä¸²è¡Œå’Œå¹¶è¡Œçš„å®ç°</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_012-promise-é™åˆ¶å¹¶è¡Œè°ƒåº¦å™¨" class="sidebar-link">012ï¼š Promise é™åˆ¶å¹¶è¡Œè°ƒåº¦å™¨</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_013-promise-all-æ•è·é”™è¯¯" class="sidebar-link">013ï¼š Promise.all æ•è·é”™è¯¯</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_014-async-await-æ•è·é”™è¯¯" class="sidebar-link">014ï¼š async/await æ•è·é”™è¯¯</a></li><li class="sidebar-sub-header"><a href="/fragments/ES6.html#_015-es6-class-å®ç°åŸç†-babel-æ˜¯å¦‚ä½•ç¼–è¯‘-class-çš„" class="sidebar-link">015ï¼š ES6 Class å®ç°åŸç†ï¼ˆBabel æ˜¯å¦‚ä½•ç¼–è¯‘ class çš„ï¼‰</a></li></ul></li><li><a href="/fragments/CSS.html" class="sidebar-link">ğŸŒµ CSS</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="es6"><a href="#es6" class="header-anchor">#</a> ğŸŒµ ES6</h1> <h2 id="_001-varã€-let-åŠ-const-åŒºåˆ«"><a href="#_001-varã€-let-åŠ-const-åŒºåˆ«" class="header-anchor">#</a> 001ï¼š varã€ let åŠ const åŒºåˆ«ï¼Ÿ</h2> <p>ï¼ˆ1ï¼‰ var åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹å£°æ˜çš„å˜é‡ä¼šæŒ‚è½½åœ¨ window å¯¹è±¡ä¸Šï¼Œlet å’Œ const åˆ™ä¸ä¼šã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> constValue <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> letValue <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> varValue <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>constValue<span class="token punctuation">,</span> window<span class="token punctuation">.</span>letValue<span class="token punctuation">,</span> window<span class="token punctuation">.</span>varValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// undefined undefined 3</span>
</code></pre></div><p>ï¼ˆ2ï¼‰var å£°æ˜çš„å˜é‡ä¼šè¢«æå‡åˆ°ä½œç”¨åŸŸçš„é¡¶éƒ¨ï¼Œè€Œ let å’Œ const åˆ™ä¸ä¼šã€‚</p> <p>var å˜é‡æå‡ï¼Œåœ¨å®šä¹‰å‰ä½¿ç”¨ä¼šæ˜¯undefinedï¼›let constä¸ä¼šå˜é‡æå‡ï¼Œå®šä¹‰å‰ä½¿ç”¨ä¼šæŠ¥ ReferenceErrorã€‚</p> <p>å› ä¸ºå­˜åœ¨<strong>æš‚æ—¶æ€§æ­»åŒºï¼ˆTemporal Dead Zoneï¼Œç®€å†™ä¸º TDZï¼‰å’Œå—çº§ä½œç”¨åŸŸ</strong>ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨å£°æ˜å‰å°±ä½¿ç”¨ let å’Œ const ä½¿ç”¨å£°æ˜çš„å˜é‡ï¼Œlet å’Œ const åªåœ¨å£°æ˜æ‰€åœ¨å—çº§ä½œç”¨åŸŸå†…æœ‰æ•ˆã€‚</p> <p>æš‚æ—¶æ€§æ­»åŒºï¼šåªè¦ä¸€è¿›å…¥å½“å‰ä½œç”¨åŸŸï¼Œæ‰€è¦ä½¿ç”¨çš„å˜é‡å°±å·²ç»å­˜åœ¨äº†ï¼Œä½†æ˜¯ä¸å¯è·å–ï¼Œåªæœ‰ç­‰åˆ°å£°æ˜å˜é‡çš„é‚£ä¸€è¡Œä»£ç è¿è¡Œä¹‹åï¼Œæ‰å¯ä»¥è·å–å’Œä½¿ç”¨è¯¥å˜é‡ã€‚</p> <p>å—çº§ä½œç”¨åŸŸï¼šes5 åªæœ‰å…¨å±€/å‡½æ•°å±€éƒ¨ä½œç”¨åŸŸï¼Œæ²¡æœ‰å—çº§ä½œç”¨åŸŸä¼šå¯¼è‡´å†…å±‚å˜é‡è¦†ç›–å¤–å±‚å˜é‡ï¼ˆå˜é‡å†²çªï¼‰ï¼Œå¾ªç¯è®°æ•°çš„å˜é‡æˆäº†å…¨å±€å˜é‡ã€‚let/const å­˜åœ¨å—çº§ä½œç”¨åŸŸï¼Œä¸ä¼šç›¸äº’è¦†ç›–/é‡å¤ï¼ˆä»£ç å—åˆ†ç¦»ã€å¤–å±‚è¯»å–ä¸åˆ°å†…å±‚ï¼‰ã€‚</p> <p>æš‚æ—¶æ€§æ­»åŒºå’Œå—çº§ä½œç”¨åŸŸçš„æ„ä¹‰åœ¨äºï¼šä¸ºäº†å‡å°‘è¿è¡Œæ—¶é”™è¯¯ï¼Œé˜²æ­¢åœ¨å˜é‡å£°æ˜å‰å°±ä½¿ç”¨è¿™ä¸ªå˜é‡ï¼Œä»è€Œå¯¼è‡´æ„æ–™ä¹‹å¤–çš„è¡Œä¸ºã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> condition <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> baz <span class="token operator">=</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> bom <span class="token operator">=</span> <span class="token string">&quot;bom&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught ReferenceError: bar is not defined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bom<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught ReferenceError: bom is not defined</span>
</code></pre></div><p>ï¼ˆ3ï¼‰var å£°æ˜çš„å˜é‡åå­—å¯é‡å¤ï¼Œç±»å‹å’Œå€¼å¯ä¿®æ”¹ï¼›let å’Œ const ä¸èƒ½é‡å¤å£°æ˜ï¼›</p> <p>let å£°æ˜çš„å˜é‡å€¼å’Œç±»å‹éƒ½å¯ä»¥æ”¹å˜ï¼›</p> <p>const åœ¨å£°æ˜çš„æ—¶å€™å¿…é¡»èµ‹äºˆåˆå§‹å€¼ï¼Œä¸€æ—¦å£°æ˜å€¼å°±ä¸èƒ½æ”¹å˜ï¼ˆå€¼æ˜¯åŸå§‹æ•°æ®ç±»å‹çš„ä¸å¯æ”¹å˜ï¼Œå€¼æ˜¯å¼•ç”¨ç±»å‹ç»‘å®šçš„åœ°å€ï¼Œåœ°å€ä¸å¯å˜ï¼Œä½†å±æ€§å€¼èƒ½æ”¹å˜ï¼‰ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught SyntaxError: Identifier 'value' has already been declared</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught SyntaxError: Identifier 'value' has already been declared</span>

<span class="token keyword">const</span> obj<span class="token punctuation">;</span>  <span class="token comment">// Uncaught SyntaxError: Missing initializer in const declaration</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'obj'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">//Uncaught SyntaxError: Identifier 'obj' has already been declared</span>

obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'chieminchan'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// {name: &quot;chieminchan&quot;}</span>
</code></pre></div><p>âš ï¸ å¾ªç¯ä¸­çš„å—çº§ä½œç”¨åŸŸé—®é¢˜ï¼š</p> <ul><li><p>ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„ for å¾ªç¯æ‰“å° i çš„é—®é¢˜ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ES6 ä¸­çš„ let æä¾›äº†è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œlet ä¸æå‡ä¸èƒ½é‡å¤å£°æ˜ï¼Œä¹Ÿä¸èƒ½ç»‘å®šå…¨å±€ä½œç”¨åŸŸç­‰ç­‰ç‰¹æ€§ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆåœ¨å¾ªç¯ä¸­å¯ä»¥åˆ©ç”¨ let å¤šæ¬¡è¿›è¡Œå¯¹ i å£°æ˜ï¼Œå¹¶ä¸”è¿™é‡Œå°±èƒ½æ­£ç¡®æ‰“å°å‡º i å€¼å‘¢ï¼Ÿ</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;-----iterator with let-------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// -----iterator with let-------</span>
<span class="token comment">// abc</span>
<span class="token comment">// abc</span>
<span class="token comment">// abc</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;-----iterator with var-------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// -----iterator with var-------</span>
<span class="token comment">// abc</span>
</code></pre></div><p>è¾“å‡ºç»“æœä¸ä¸€æ ·çš„ä¸»è¦åŸå› æ˜¯å› ä¸ºï¼Œåœ¨ for å¾ªç¯ä¸­ä½¿ç”¨ let å’Œ varï¼Œåº•å±‚ä¼šä½¿ç”¨ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚</p> <p>å½“åœ¨<code>for (let i = 0; i &lt; 3; i++)</code>ä¸­ï¼Œå³åœ†æ‹¬å·ä¹‹å†…å»ºç«‹ä¸€ä¸ªéšè—çš„ä½œç”¨åŸŸï¼Œç„¶ååœ¨æ¯æ¬¡è¿­ä»£å¾ªç¯æ—¶éƒ½<strong>åˆ›å»ºä¸€ä¸ªæ–°å˜é‡</strong>ï¼Œå¹¶ä¸”ä¼šä»¥ä¹‹å‰è¿­ä»£ä¸­åŒåå˜é‡çš„å€¼å°†å…¶åˆå§‹åŒ–ã€‚è¿™æ ·å­ï¼Œè€ç”Ÿå¸¸è°ˆä½¿ç”¨ let æ‰“å° i çš„å¾ªç¯è¿‡ç¨‹ä¾¿å¯ä»¥ç†è§£ä¸ºï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// ä¼ªä»£ç </span>
<span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>è‹¥åˆ©ç”¨ const ä»£æ›¿ let æ¥è¿›è¡Œ for éå†å´ä¼šäº§ç”Ÿè¿™æ ·å­çš„æƒ…å†µï¼š</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Uncaught TypeError: Assignment to constant variable.</span>
</code></pre></div><p>ç»“æœä¼šæŠ¥é”™ï¼Œï¼Œå› ä¸ºè™½ç„¶æˆ‘ä»¬æ¯æ¬¡éƒ½åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œä½†åœ¨åœ†æ‹¬å·ä¹‹å†…å»ºç«‹çš„éšè—çš„ä½œç”¨åŸŸä¸­å°è¯•ä¿®æ”¹äº† const çš„å€¼ï¼Œæ‰€ä»¥æœ€ç»ˆä¼šæŠ¥é”™ã€‚</p> <h2 id="_002-ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«"><a href="#_002-ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«" class="header-anchor">#</a> 002ï¼š ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«ï¼Ÿ</h2> <ol><li>ç®­å¤´å‡½æ•°æ˜¯åŒ¿åå‡½æ•°ï¼Œä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ new å»è°ƒç”¨ï¼Œç®­å¤´å‡½æ•°æ²¡æœ‰åŸå‹å±æ€§ï¼›</li> <li>ç®­å¤´å‡½æ•°ä¸ç»‘å®š argumentsï¼Œå–è€Œä»£ä¹‹å¯ä»¥ç”¨æ‰©å±•è¿ç®—ç¬¦...è§£å†³</li> <li>ç®­å¤´å‡½æ•°æ²¡æœ‰ thisï¼Œå‡½æ•°é‡Œçš„ this ä¼šæ ¹æ®è¯æ³•ä½œç”¨åŸŸå†³å®šï¼Œç»§æ‰¿å¤–å±‚å‡½æ•°è°ƒç”¨çš„ this ç»‘å®šï¼Œä¸èƒ½é€šè¿‡ bindã€callã€apply æ˜¾å¼æ”¹å˜ this æŒ‡å‘ã€‚</li></ol> <h2 id="_003-set-å’Œ-weaksetã€map-å’Œ-weakmap-åŒºåˆ«"><a href="#_003-set-å’Œ-weaksetã€map-å’Œ-weakmap-åŒºåˆ«" class="header-anchor">#</a> 003ï¼š Set å’Œ WeakSetã€Map å’Œ WeakMap åŒºåˆ«ï¼Ÿ</h2> <p>Set å’Œ Map ä¸»è¦çš„åº”ç”¨åœºæ™¯åœ¨äº æ•°æ®é‡ç»„ å’Œ æ•°æ®å‚¨å­˜ã€‚ Set æ˜¯ä¸€ç§å«åšé›†åˆçš„æ•°æ®ç»“æ„ï¼ŒMap æ˜¯ä¸€ç§å«åšå­—å…¸çš„æ•°æ®ç»“æ„ã€‚</p> <p>Setï¼š<br>
ç±»ä¼¼äºæ•°ç»„ï¼Œä½†æˆå‘˜æ˜¯å”¯ä¸€ä¸”æ— åºçš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚<br>
Set å†…éƒ¨åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸åŒï¼Œä½¿ç”¨çš„ç®—æ³•å«åš<code>Same-value-zero equality</code>ï¼Œå®ƒç±»ä¼¼äºç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯<strong>NaN ç­‰äºè‡ªèº«ï¼Œè€Œç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦è®¤ä¸º NaN ä¸ç­‰äºè‡ªèº«ã€‚</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">NaN</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">NaN</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">;</span> <span class="token comment">// Set {NaN}</span>

<span class="token keyword">let</span> set1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>set1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [5, &quot;5&quot;]</span>
</code></pre></div><p>å±æ€§ï¼šsizeã€constructor<br>
æ–¹æ³•ï¼šaddã€deleteã€hasã€</p> <p>Mapï¼šç±»ä¼¼äºå¯¹è±¡ï¼Œä½†é”®ç±»å‹ä¸é™åˆ¶äºå­—ç¬¦ä¸²ï¼Œå¯å¤šç§ç±»å‹ã€‚</p> <h4 id="map-å’Œ-object-çš„å¯¹æ¯”"><a href="#map-å’Œ-object-çš„å¯¹æ¯”" class="header-anchor">#</a> Map å’Œ Object çš„å¯¹æ¯”</h4> <p><a href="https://zhuanlan.zhihu.com/p/358378689" target="_blank" rel="noopener noreferrer">JS é¡¹ç›®ä¸­ç©¶ç«Ÿåº”è¯¥ä½¿ç”¨ Object è¿˜æ˜¯ Map?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_004-class-å’Œæ™®é€šæ„é€ å‡½æ•°çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#_004-class-å’Œæ™®é€šæ„é€ å‡½æ•°çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="header-anchor">#</a> 004ï¼š Class å’Œæ™®é€šæ„é€ å‡½æ•°çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2> <ol><li><p>æå‡ï¼š</p> <ul><li>Class ä¸å­˜åœ¨å˜é‡æå‡ï¼Œå†…éƒ¨é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œå¿…é¡»å…ˆå®šä¹‰åä½¿ç”¨</li> <li>æ™®é€šæ„é€ å‡½æ•°å­˜åœ¨å˜é‡æå‡ï¼Œå¯åœ¨å®šä¹‰å‰è°ƒç”¨</li></ul></li> <li><p>è°ƒç”¨æ–¹å¼ï¼š</p> <ul><li>Class æ„é€ å®ä¾‹å¿…é¡»é€šè¿‡ new è°ƒç”¨æ‰§è¡Œ</li> <li>æ™®é€šæ„é€ å‡½æ•°ä¸ç”¨ new ä¹Ÿå¯ä»¥æ‰§è¡Œ</li></ul></li> <li><p>æ–¹æ³•å·®å¼‚ï¼š</p> <ul><li><p>æ–¹æ³•å®šä¹‰ï¼š</p> <ul><li>Class ä¸­çš„æ–¹æ³•ç›´æ¥å®šä¹‰åœ¨ç±»çš„å®šä¹‰å—å†…ï¼Œæ›´ç®€æ´ï¼ˆä¼šè‡ªåŠ¨æ·»åŠ åˆ° prototype ä¸Šï¼‰</li> <li>æ™®é€šæ„é€ å‡½æ•°éœ€æ‰‹åŠ¨é€šè¿‡ prototype å±æ€§æ·»åŠ æ–¹æ³•</li></ul></li> <li><p>åŸå‹æ–¹æ³•å¯æšä¸¾æ€§ï¼š</p> <ul><li>Class åŸå‹é“¾ä¸Šçš„å±æ€§å’Œæ–¹æ³•ä¸å¯æšä¸¾</li> <li>æ™®é€šæ„é€ å‡½æ•°åŸå‹é“¾ä¸Šçš„å±æ€§å’Œæ–¹æ³•å¯ä»¥æšä¸¾</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">like</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">like</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [like]</span>


<span class="token comment">//es6</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">like</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">like </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// []</span>
</code></pre></div></li> <li><p>ç»§æ‰¿å®ç°å·®å¼‚ï¼š
Class ç»“æ„ç®€æ´æ¸…æ™°ï¼Œæ™®é€šæ„é€ å‡½æ•°ç»§æ‰¿ç¹çæ˜“é”™</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ™®é€šæ„é€ å‡½æ•°ç»§æ‰¿ï¼ˆç¹çæ˜“é”™ï¼‰ï¼š</span>
<span class="token comment">// é€šè¿‡æ„é€ å‡½æ•°å’ŒåŸå‹é“¾å®ç°ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®åŸå‹ï¼ˆå¦‚Child.prototype = Object.create(Parent.prototype)ï¼‰</span>
<span class="token comment">// å’Œä¿®å¤æ„é€ å‡½æ•°ï¼ˆChild.prototype.constructor = Childï¼‰ï¼Œä»¥åŠè°ƒç”¨çˆ¶æ„é€ å‡½æ•°ï¼ˆParent.call(this, ...)ï¼‰</span>
<span class="token keyword">function</span> <span class="token function">Father</span> <span class="token punctuation">(</span><span class="token parameter">firstName<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Son</span> <span class="token punctuation">(</span><span class="token parameter">firstName<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Father</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Son<span class="token punctuation">;</span>
<span class="token class-name">Son</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">talk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token comment">// Class ç»§æ‰¿ï¼ˆç®€æ´æ¸…æ™°ï¼‰ï¼š</span>
<span class="token comment">// ä½¿ç”¨`extends`å…³é”®å­—å’Œ`super`æ–¹æ³•ï¼Œè¯­æ³•æ›´æ¸…æ™°ã€‚</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">firstName<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>ç‰¹æ®Šæ–¹æ³•æ”¯æŒï¼š</p> <ul><li><p>Class æ”¯æŒé™æ€æ–¹æ³•ï¼ˆstaticï¼‰ã€ç§æœ‰å­—æ®µã€getter/setterç­‰ç‰¹æ€§</p> <ul><li><p>é™æ€å±æ€§æ–¹æ³•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MathUtils</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> sumNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
MathUtils<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// âœ… åˆæ³•</span>

<span class="token keyword">const</span> mathUtils <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MathUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mathUtils<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âŒ TypeError: mathUtils.sum is not a function</span>

<span class="token keyword">class</span> <span class="token class-name">Utils</span> <span class="token keyword">extends</span> <span class="token class-name">MathUtils</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Utils<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªåŠ¨ç»§æ‰¿é™æ€æ–¹æ³•</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>MathUtils<span class="token punctuation">.</span>sumNum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªåŠ¨ç»§æ‰¿é™æ€å±æ€§</span>

<span class="token comment">//es5</span>
<span class="token keyword">function</span> <span class="token function">MathUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
MathUtils<span class="token punctuation">.</span><span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
</code></pre></div><p>å¯ä»¥ç›´æ¥é€šè¿‡<code>ç±»æœ¬èº«.staticå±æ€§/æ–¹æ³•</code>è®¿é—®é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œé™æ€å±æ€§æ–¹æ³•å¯ä»¥ç»§æ‰¿ï¼Œä½†ç±»çš„å®ä¾‹ä¸å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p></li> <li><p>ç§æœ‰å±æ€§æ–¹æ³•ï¼ˆES2022+ï¼‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    #age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// ç§æœ‰å­—æ®µ</span>
    
    <span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>#age<span class="token operator">++</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Age: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>#age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">static</span> <span class="token function">getSecret</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#age<span class="token punctuation">;</span> <span class="token comment">// âŒ SyntaxError: Private field '#age' must be declared in an enclosing class</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token function">getSecretFromInstance</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">.</span>#age<span class="token punctuation">;</span> <span class="token comment">// âœ… åˆæ³•ï¼Œåªè¦åœ¨ç±»ä½œç”¨åŸŸå†…</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Age: 1</span>
p<span class="token punctuation">.</span>#age<span class="token punctuation">;</span>       <span class="token comment">// âŒ è¯­æ³•é”™è¯¯ï¼šPrivate field must be declared in an enclosing class</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span><span class="token function">getSecretFromInstance</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âœ… è¾“å‡º 1</span>
</code></pre></div><p>#secret æ˜¯å®ä¾‹ç§æœ‰å­—æ®µï¼Œå¿…é¡»é€šè¿‡æŸä¸ªå®ä¾‹è®¿é—®ã€‚</p></li> <li><p>super/extends ç®€åŒ–ç»§æ‰¿</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token function">speak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›´æ¥è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'And then barks!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ES5 ç­‰ä»·å®ç°</span>
<span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">speak</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¹ççš„è°ƒç”¨æ–¹å¼</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'And then barks!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>æ™®é€šæ„é€ å‡½æ•°éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼æ¨¡æ‹Ÿè¿™äº›ç‰¹æ€§</p></li></ul></li></ol> <h2 id="_005-class-ä¸­çš„-this-æŒ‡å‘"><a href="#_005-class-ä¸­çš„-this-æŒ‡å‘" class="header-anchor">#</a> 005ï¼š Class ä¸­çš„ this æŒ‡å‘</h2> <ol><li><p>new è°ƒç”¨åçš„è¿”å›ï¼Œä¼šæ ¹æ® constructor æ„é€ å™¨é‡Œé¢è¿”å›æ¥å†³å®šï¼ˆæ²¡è¿”å›åˆ™è¿”å›ä¸€ä¸ªæ­£å¸¸å®ä¾‹å¯¹è±¡ã€‚æœ‰åˆ™æŒ‰ constructor è¿”å›çš„æ¥ï¼‰ã€‚</p></li> <li><p>Class ä¸­çš„ this æŒ‡å‘ï¼š</p></li></ol> <ul><li><p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼šthis æŒ‡å‘æ–°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">// this = æ–°å®ä¾‹</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// Animal {name: 'dog'}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> animal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>åœ¨æ™®é€šæ–¹æ³•ä¸­ï¼šthis é»˜è®¤æŒ‡å‘è°ƒç”¨è¯¥æ–¹æ³•çš„å®ä¾‹å¯¹è±¡</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    name <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    sparkTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token function">spark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>sparkTime<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// this = è°ƒç”¨æ­¤æ–¹æ³•çš„å®ä¾‹</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">',sparkTime:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sparkTime<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dog<span class="token punctuation">.</span><span class="token function">spark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dog,sparkTime: 1</span>

<span class="token keyword">const</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cat<span class="token punctuation">.</span><span class="token function">spark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cat,sparkTime: 1</span>

<span class="token keyword">const</span> bird <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'bird'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bird<span class="token punctuation">.</span><span class="token function">spark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bird,sparkTime: 1</span>
</code></pre></div></li> <li><p>åœ¨é™æ€æ–¹æ³•ä¸­ï¼šthis æŒ‡çš„æ˜¯ç±»ï¼ˆæ„é€ å‡½æ•°æœ¬èº«ï¼‰ï¼ˆå¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•å‰ï¼ŒåŠ ä¸Š static å…³é”®å­—ï¼Œå°±è¡¨ç¤ºè¯¥æ–¹æ³•å¯è¢«å­ç±»ç»§æ‰¿ï¼Œä¸å¯è¢«å®ä¾‹ç»§æ‰¿ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨ï¼Œè¿™ç§°ä¸ºâ€œé™æ€æ–¹æ³•â€ã€‚é™æ€æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥ä» super å¯¹è±¡ä¸Šè°ƒç”¨çš„ï¼Œé™æ€å±æ€§ç±»åŒï¼‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MathUtils</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> MathUtils<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
MathUtils<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>å¦‚æœè¢«å•ç‹¬æ‹å‡ºæ¥ï¼Œæ–¹æ³•ä¸­çš„ this ä¼šæŒ‡å‘è¯¥æ–¹æ³•è¿è¡Œæ—¶æ‰€åœ¨çš„ç¯å¢ƒã€‚ï¼ˆæƒ³è¦ this æŒ‡å‘å®ä¾‹ï¼Œå¯ä»¥åœ¨ constructor ä¸­ä½¿ç”¨ thisï¼Œæˆ–è€…ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œæˆ–è€… proxyï¼‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">DataFetcher</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token comment">// å°†ç±»æ–¹æ³•ä½œä¸ºå›è°ƒä¼ é€’ï¼Œä¸¢å¤±this</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> response<span class="token punctuation">;</span> <span class="token comment">// âŒ this ä¸¢å¤±</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ–¹æ¡ˆ1: ç®­å¤´å‡½æ•°</span>
<span class="token comment">// ç®­å¤´å‡½æ•°ç±»å­—æ®µï¼šå®šä¹‰æ—¶ç»‘å®šåˆ°å®ä¾‹</span>
<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> response<span class="token punctuation">;</span> <span class="token comment">// âœ…</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ–¹æ¡ˆ2: ç»‘å®šthis</span>
<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>æœ€ä½³å®è·µï¼š</p> <ol><li>é™æ€æ–¹æ³•ä¸­è®¿é—®ç±»å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œä½¿ç”¨ <code>this</code> æŒ‡å‘ç±»æœ¬èº«ã€‚</li> <li>å¦‚æœå¸Œæœ›æ–¹æ³•ä¸­çš„ <code>this</code> å§‹ç»ˆç»‘å®šå®ä¾‹ï¼Œä½¿ç”¨ç±»å­—æ®µç®­å¤´å‡½æ•°ï¼ˆç®­å¤´å‡½æ•°this æŒ‡å‘å®šä¹‰æ—¶æ‰€åœ¨ä¸Šä¸‹æ–‡ï¼‰ã€‚</li> <li>å¦‚æœä¸éœ€è¦ç»‘å®šï¼Œä½¿ç”¨æ™®é€šæ–¹æ³•ï¼Œä½†åœ¨ä½œä¸ºå›è°ƒä¼ é€’æ—¶æ³¨æ„ä½¿ç”¨ç®­å¤´å‡½æ•°åŒ…è£¹æˆ–ç»‘å®šã€‚</li></ol></li></ul> <h2 id="_006-class-ä¸­çš„-super-ç”¨æ³•"><a href="#_006-class-ä¸­çš„-super-ç”¨æ³•" class="header-anchor">#</a> 006ï¼š Class ä¸­çš„ super ç”¨æ³•</h2> <p>super å…³é”®å­—ï¼Œä¸€èˆ¬è¡¨ç¤ºçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç”¨æ¥æ–°å»ºçˆ¶ç±»çš„ this å¯¹è±¡ã€‚å­ç±»å¿…é¡»åœ¨ constructor æ–¹æ³•ä¸­è°ƒç”¨ super æ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹æ—¶ä¼šæŠ¥é”™ã€‚å› ä¸ºå­ç±»è‡ªå·±çš„ this å¯¹è±¡å¿…é¡»å…ˆé€šè¿‡çˆ¶ç±»çš„æ„é€ å‡½æ•°å®Œæˆå¡‘é€ ï¼Œå¾—åˆ°ä¸çˆ¶ç±»åŒæ ·çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œç„¶åå†å¯¹å…¶è¿›è¡ŒåŠ å·¥ï¼ŒåŠ ä¸Šå­ç±»è‡ªå·±çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ã€‚</p> <p>super åªèƒ½è®¿é—®çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œé™æ€æ–¹æ³•ï¼Œä¸èƒ½ç›´æ¥è®¿é—®å®ä¾‹å±æ€§ã€‚</p> <ol><li><p>åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨ <code>super()</code>
ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œsuper()åªèƒ½ç”¨åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¹‹ä¸­ï¼Œç›¸å½“äº çˆ¶ç±».prototype.constructor.call(this)ï¼Œthis æŒ‡å‘å„ä¸ªå­ç±»ç¯å¢ƒã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// constructor å’Œ super éƒ½é»˜è®¤è¢«åˆ›å»º</span>
<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// new.target.nameæŒ‡å‘å½“å‰æ‰§è¡Œç¯å¢ƒ</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// åªæœ‰ä½¿ç”¨ extends æ‰èƒ½ä½¿ç”¨ superï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</span>
<span class="token keyword">class</span> <span class="token class-name">ColorPoint</span> <span class="token keyword">extends</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Point.prototype.constructor.call(this, ...args)</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¿…é¡»å†™åœ¨ this ä¹‹å‰ï¼Œå¦åˆ™ä¼šæŠ›å‡º ReferenceErrorã€‚</span>
        <span class="token comment">// this. props = ...args</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point</span>
<span class="token keyword">new</span> <span class="token class-name">ColorPoint</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ColorPoint, 12, 13</span>
</code></pre></div></li> <li><p>åœ¨æ™®é€šæ–¹æ³•ä¸­è°ƒç”¨ <code>super.method()</code>ï¼ˆè®¿é—®çˆ¶ç±»æ–¹æ³•ï¼‰
æŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼ˆsuper.p() = çˆ¶ç±».prototype.p()ï¼‰ï¼Œå¯åœ¨å­ç±»æ–¹æ³•ä¸­è¦†ç›–çˆ¶ç±»æ–¹æ³•æ—¶ä½¿ç”¨ã€‚
åœ¨å­ç±»æ™®é€šæ–¹æ³•ä¸­é€šè¿‡ super è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œçˆ¶ç±»ä¸­æ–¹æ³•å†…éƒ¨çš„ this æŒ‡å‘å½“å‰çš„å­ç±»å®ä¾‹ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token comment">// Aç±»åŸå‹ä¸Šçš„æ–¹æ³•ä¸­çš„thisä¼šæŒ‡å‘å­ç±»çš„å®ä¾‹</span>
     <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;print method is A:&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// super.print() è°ƒç”¨çš„æ˜¯çˆ¶ç±»åŸå‹å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼ŒA.prototype.print()</span>
         <span class="token comment">// A.prototype.print()å†…éƒ¨çš„thisæŒ‡å‘å­ç±»Bçš„å®ä¾‹</span>
         <span class="token comment">// é€šè¿‡ super è°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œthis ä»æŒ‡å‘å½“å‰å­ç±»å®ä¾‹</span>
         <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 b<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;print method is A: b&quot;</span>
</code></pre></div><p>super å½“ä½œå¯¹è±¡è®¿é—®å±æ€§,è®¿é—®çˆ¶ç±»å®ä¾‹å±æ€§/getterï¼ˆå°‘è§ä½†åˆæ³•ï¼‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'parent info'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>info <span class="token operator">+</span> <span class="token string">' + child info'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º parent info + child info</span>
</code></pre></div></li> <li><p>åœ¨é™æ€æ–¹æ³•ä¸­è°ƒç”¨ <code>super.method()</code>ï¼ˆè®¿é—®çˆ¶ç±»é™æ€æ–¹æ³•ï¼‰
åªèƒ½åœ¨å­ç±»é™æ€æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œsuper æŒ‡å‘çˆ¶ç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯å®ä¾‹ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;static&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;instance&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">myMethod</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent.prototype.myMethod(msg);</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">myMethod</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent.myMethod(msg);</span>
    <span class="token punctuation">}</span>

    <span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">myMethod</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent.prototype.myMethod(msg);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// è°ƒç”¨å­ç±»ä¸­çš„é™æ€æ–¹æ³•ï¼Œå³è°ƒç”¨äº†çˆ¶ç±»ä¸­çš„é™æ€æ–¹æ³•</span>
Child<span class="token punctuation">.</span><span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// static 1</span>

<span class="token comment">// æ™®é€šæ–¹æ³•è¢«ç»§æ‰¿ï¼Œè°ƒç”¨äº†å­ç±»åŸå‹ä¸Šçš„æ™®é€šæ–¹æ³•ï¼Œä»è€Œè°ƒç”¨åˆ°äº†çˆ¶ç±»åŸå‹å¯¹è±¡ä¸Šçš„æ–¹æ³•</span>
<span class="token keyword">var</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// instance 2</span>
child<span class="token punctuation">.</span><span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// instance 2</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token function">getParentValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// superåªèƒ½è®¿é—®çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•å’Œé™æ€æ–¹æ³•ï¼Œä¸èƒ½ç›´æ¥è®¿é—®å®ä¾‹å±æ€§</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// âŒ è¿”å› undefined</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token function">getParentValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// âœ… é€šè¿‡å®ä¾‹è®¿é—®</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å®ä¾‹å±æ€§ï¼Œä¸å½±å“é™æ€å±æ€§</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>

    <span class="token comment">// åœ¨äºé™æ€æ–¹æ³•ä¸­ this çš„æŒ‡å‘å’Œé™æ€å±æ€§çš„ä½œç”¨åŸŸ</span>
    <span class="token comment">// 3. çˆ¶ç±»çš„é™æ€æ–¹æ³•printä¸­çš„thisæŒ‡å‘è¿™ä¸ªç±»ï¼Œåœ¨Bä¸­è°ƒç”¨å› æ­¤æŒ‡å‘Bç±»</span>
    <span class="token keyword">static</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å…³é”®ç‚¹ï¼šé™æ€æ–¹æ³•ä¸­çš„ this æŒ‡å‘å½“å‰ç±»</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å®ä¾‹å±æ€§ï¼Œä¸å½±å“é™æ€å±æ€§</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2. ç›´æ¥è®¿é—®Bä¸­çš„é™æ€æ–¹æ³•ï¼Œæ­¤æ—¶superæŒ‡å‘çˆ¶ç±»ï¼Œå³è°ƒç”¨äº†çˆ¶ç±»ä¸­çš„é™æ€æ–¹æ³•print</span>
    <span class="token keyword">static</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// super åªæŒ‡å®šæ–¹æ³•æ‰€åœ¨çš„çˆ¶ç±»ï¼Œä½†æ–¹æ³•å†…éƒ¨çš„ this ä»ç”±è°ƒç”¨è€…å†³å®š;å®é™…æ‰§è¡Œï¼šA.print.call(B)</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 1. ç›´æ¥ä¿®æ”¹Bå¯¹è±¡ä¸Šçš„xå€¼ä¸º3</span>
<span class="token comment">// ç­‰ä»·äº B ç±»ä¸Šæ·»åŠ é™æ€å±æ€§ï¼šclass B { static x = 3 }</span>
<span class="token constant">B</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token comment">// å¦‚æœå»æ‰ B.x=3 ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</span>
<span class="token comment">// ä¼šè¾“å‡º undefinedï¼Œå› ä¸ºAå’ŒBéƒ½æ²¡æœ‰é™æ€å±æ€§ï¼ŒAåªæœ‰å®ä¾‹å±æ€§</span>
</code></pre></div></li></ol> <h2 id="_007-es6-çš„-class-ç»§æ‰¿å’Œ-es5-çš„ç»§æ‰¿åŒºåˆ«"><a href="#_007-es6-çš„-class-ç»§æ‰¿å’Œ-es5-çš„ç»§æ‰¿åŒºåˆ«" class="header-anchor">#</a> 007ï¼š ES6 çš„ Class ç»§æ‰¿å’Œ ES5 çš„ç»§æ‰¿åŒºåˆ«</h2> <ul><li><p>åŒºåˆ« 1ï¼Œthis åˆ›å»ºé¡ºåºä¸ä¸€æ ·:</p> <ul><li><p>ES5 ä¸­ï¼Œå­ç±»å…ˆåˆ›å»ºå®ä¾‹å¯¹è±¡ thisï¼ˆnewæ“ä½œï¼‰ï¼Œç„¶ååœ¨å­ç±»æ„é€ å‡½æ•°ä¸­ï¼Œå°†çˆ¶ç±»çš„å®ä¾‹å±æ€§æ–¹æ³•æ·»åŠ åˆ°å­ç±»å®ä¾‹å¯¹è±¡ this ä¸Šé¢ï¼ˆParent.apply(this)ï¼‰</p></li> <li><p>ES6 ä¸­ï¼Œå…ˆåˆ›å»ºçˆ¶ç±»çš„å®ä¾‹å¯¹è±¡ thisï¼ˆå³çˆ¶ç±»çš„æ„é€ å‡½æ•°å†…éƒ¨çš„thisæŒ‡å‘å­ç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å¿…é¡»å…ˆè°ƒç”¨ super æ–¹æ³•ï¼‰ï¼Œå†ç”¨å­ç±»çš„æ„é€ å‡½æ•°ä¿®é¥° thisã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// es5</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­ç±» this ä¸Šæ·»åŠ çˆ¶ç±»å±æ€§</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>childProp <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ¯”å¦‚è‡ªå®šä¹‰CustomArrayç»§æ‰¿ Arrayï¼ŒCustomArrayæ— æ³•æ­£ç¡®ç»§æ‰¿Arrayå†…éƒ¨çš„lengthå±æ€§</span>
<span class="token keyword">function</span> <span class="token function">MyArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Array</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä»¥ä¸‹ç­‰åŒï¼šChild.prototype = new Array();</span>
<span class="token comment">// ä¹Ÿå¯ä»¥ç­‰åŒï¼šObject.setPrototypeOf(MyArray.prototype, Array.prototype);</span>
<span class="token class-name">MyArray</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">constructor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> MyArray<span class="token punctuation">,</span>
        <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å­ç±»å®ä¾‹åŒ–æ—¶çˆ¶ç±»å†…éƒ¨å±æ€§æ— æ³•è¢«æ­£ç¡®ç»§æ‰¿ã€‚</span>
<span class="token keyword">var</span> colors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>

colors<span class="token punctuation">.</span>length  <span class="token comment">// 0</span>

colors<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
colors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">// &quot;red&quot;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// es6</span>
<span class="token comment">// constructor å’Œ super éƒ½é»˜è®¤è¢«åˆ›å»º</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// ç­‰åŒäº</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// å…ˆåˆ›å»ºçˆ¶ç±» thisï¼Œåœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å…ˆè°ƒç”¨ super()æ–¹æ³•ï¼Œä¹‹åå†èƒ½ä½¿ç”¨ this</span>
        <span class="token comment">// æ˜¯å› ä¸ºå­ç±»å®ä¾‹çš„æ„å»ºï¼Œæ˜¯åŸºäºå¯¹çˆ¶ç±»å®ä¾‹åŠ å·¥ï¼Œåªæœ‰superæ–¹æ³•æ‰èƒ½è¿”å›çˆ¶ç±»å®ä¾‹ï¼›</span>

        <span class="token comment">// superè™½ç„¶ä»£è¡¨äº†çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯å­ç±»Sonçš„å®ä¾‹ï¼Œå³superå†…éƒ¨çš„thisæŒ‡å‘çš„æ˜¯Childï¼Œ</span>
        <span class="token comment">// superæŒ‡å‘çˆ¶ç±»ï¼Œsuper()ä¸­çš„thisæŒ‡å‘Child</span>

        <span class="token comment">// superçš„ä½œç”¨å°±æ˜¯ åˆ›å»ºçˆ¶ç±»çš„å®ä¾‹å¯¹è±¡thisï¼ˆå³çˆ¶ç±»çš„æ„é€ å‡½æ•°å†…éƒ¨çš„thisæŒ‡å‘å­ç±»çš„å®ä¾‹ï¼‰ï¼Œç„¶åå†ç”¨å­ç±»çš„æ„é€ å‡½æ•°å»ä¿®é¥°è¿™ä¸ªthisã€‚</span>
        <span class="token comment">// å› æ­¤super()åœ¨è¿™é‡Œç›¸å½“äº Parents.constructor.call(this, ...args)ï¼›</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
        <span class="token comment">// å†ä¿®æ”¹ this</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>childProp <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span> 

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//extendså…³é”®å­—ä¸ä»…å¯ä»¥ç”¨æ¥ç»§æ‰¿ç±»ï¼Œè¿˜å¯ä»¥ç”¨æ¥ç»§æ‰¿åŸç”Ÿçš„æ„é€ å‡½æ•°ã€‚å› æ­¤å¯ä»¥åœ¨åŸç”Ÿæ•°æ®ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå®šä¹‰è‡ªå·±çš„æ•°æ®ç»“æ„ã€‚</span>
<span class="token comment">//ä¼˜åŠ¿ï¼šå­ç±»å¯ç›´æ¥ç»§æ‰¿çˆ¶ç±»å†…éƒ¨å±æ€§ï¼ˆå¦‚åŸç”Ÿæ„é€ å‡½æ•° Array çš„ length æœºåˆ¶ï¼‰</span>
<span class="token keyword">class</span> <span class="token class-name">VersionedArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>åŒºåˆ« 2ï¼Œç»§æ‰¿é“¾å·®å¼‚ï¼š</p> <ul><li><p>ES5 ç»§æ‰¿åŸå‹é“¾</p> <p>ES5 å®ç°ä¹‹ä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰<code>__proto__</code>å±æ€§ï¼ŒæŒ‡å‘å¯¹åº”çš„æ„é€ å‡½æ•°çš„ prototype å±æ€§ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>son â€”â€”_proto__â€”â€”<span class="token operator">&gt;</span> <span class="token class-name">Son</span><span class="token punctuation">.</span>prototype â€”â€”_proto__â€”â€”<span class="token operator">&gt;</span>  <span class="token class-name">Father</span><span class="token punctuation">.</span>prototype â€”â€”_proto__â€”â€”<span class="token operator">&gt;</span>  <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype

Son<span class="token punctuation">.</span>__proto__ <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype
</code></pre></div></li> <li><p>ES6 ç»§æ‰¿åŸå‹é“¾ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>son <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">Son</span><span class="token punctuation">.</span>prototype <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">Father</span><span class="token punctuation">.</span>prototype <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype

Son<span class="token punctuation">.</span>__proto__ <span class="token operator">-</span><span class="token operator">&gt;</span> Father
</code></pre></div><p>Class åº•å±‚å®é™…æœ‰ä¸¤æ¡ç»§æ‰¿é“¾ï¼š</p> <ol><li><p>å­ç±» prototype å±æ€§çš„<code>__proto__</code>å±æ€§ï¼Œè¡¨ç¤ºæ–¹æ³•çš„ç»§æ‰¿ï¼ŒæŒ‡å‘çˆ¶ç±»çš„ prototype å±æ€§ï¼ˆè·Ÿ es5 åŸå‹é“¾ç»§æ‰¿ä¸€æ ·ï¼Œ<code>Child.prototype = new Parent()</code>ï¼‰</p></li> <li><p>å­ç±» <code>__proto__</code>å±æ€§ï¼Œè¡¨ç¤ºæ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»ï¼Œå­ç±»å¯ä»¥é€šè¿‡<code>__proto__</code>å±æ€§æ‰¾åˆ°çˆ¶ç±»ï¼ˆä½†es5å­ç±»é€šè¿‡<code>__proto__</code>åªèƒ½æ‰¾åˆ°Function.prototypeï¼‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// es5</span>
<span class="token keyword">function</span> <span class="token function">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åŸå‹é“¾ç»§æ‰¿ï¼Œå­ç±»åŸå‹æŒ‡å‘çˆ¶ç±»å®ä¾‹</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Child<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// trueï¼Œç»§æ‰¿å…³ç³»</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Child<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// trueï¼Œéç»§æ‰¿å…³ç³»</span>

<span class="token comment">// es6</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Child<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Father<span class="token punctuation">,</span> <span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Father</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// ç­‰ä»·äºï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</span>
<span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span><span class="token parameter">Child<span class="token punctuation">,</span> Parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Child<span class="token punctuation">;</span>
    <span class="token comment">// å…³é”®åŒºåˆ«åœ¨è¿™é‡Œ</span>
    Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span> Parent<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>ä¹‹æ‰€ä»¥ä¼šæœ‰ä¸¤æ¡é“¾ï¼Œå› ä¸ºç±»çš„ç»§æ‰¿å®ç°æ¨¡å¼å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// B çš„å®ä¾‹ç»§æ‰¿ A çš„å®ä¾‹</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// B ç»§æ‰¿ A çš„é™æ€å±æ€§</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å…¶ä¸­Object.setPrototypeOfè¿‡ç¨‹</span>
Object<span class="token punctuation">.</span><span class="token function-variable function">setPrototypeOf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> proto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> proto<span class="token punctuation">;</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// æ‰€ä»¥ä¸Šé¢å¼å­åˆç­‰ä»·äº</span>
<span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token constant">B</span><span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">;</span>
</code></pre></div></li></ol></li></ul></li></ul> <h2 id="_008-symbol-ç”¨æ³•å’Œåº”ç”¨åœºæ™¯"><a href="#_008-symbol-ç”¨æ³•å’Œåº”ç”¨åœºæ™¯" class="header-anchor">#</a> 008ï¼š Symbol ç”¨æ³•å’Œåº”ç”¨åœºæ™¯</h2> <h2 id="_009-promise-all-çš„ç”¨æ³•ã€é”™è¯¯å¤„ç†ã€ä»¥åŠæ‰‹å†™åŸç†å®ç°"><a href="#_009-promise-all-çš„ç”¨æ³•ã€é”™è¯¯å¤„ç†ã€ä»¥åŠæ‰‹å†™åŸç†å®ç°" class="header-anchor">#</a> 009ï¼š Promise.all çš„ç”¨æ³•ã€é”™è¯¯å¤„ç†ã€ä»¥åŠæ‰‹å†™åŸç†å®ç°</h2> <h4 id="promise-all-ç”¨æ³•"><a href="#promise-all-ç”¨æ³•" class="header-anchor">#</a> Promise.all ç”¨æ³•</h4> <p>Promise.all æ¥å—ä¸€ä¸ªç”± promise å¼‚æ­¥ä»»åŠ¡ç»„æˆçš„æ•°ç»„ï¼Œå¹¶æ”¯æŒåŒæ—¶å¤„ç†å¤šä¸ª promise å¼‚æ­¥ä»»åŠ¡ã€‚å¦‚æœå…ƒç´ ä¸æ˜¯ Promise å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨ Promise.resolve è½¬æˆ Promise å¯¹è±¡ã€‚</p> <p>å½“ä¸”ä»…å½“æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆè¢« resolve ä»¥åï¼ŒPromise.all æ‰ä¼šè¢« resolveï¼Œå¹¶è¿”å›æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡ç»“æœç»„æˆçš„æ•°ç»„ï¼›å¦‚æœå…¶ä¸­æœ‰æŸä¸ªå¼‚æ­¥ä»»åŠ¡å¤±è´¥äº†ï¼Œåˆ™ä¼šè¿”å›å¤±è´¥çš„ä¿¡æ¯ï¼Œå³ä½¿å…¶ä»– promise å¼‚æ­¥ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œä¹Ÿä¼šè¿”å›å¤±è´¥ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// è¢«resolve</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¢«reject</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//thenæ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œ</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//catchæ–¹æ³•å°†ä¼šè¢«æ‰§è¡Œï¼Œè¾“å‡ºç»“æœä¸ºï¼š2</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="promise-all-é”™è¯¯å¤„ç†"><a href="#promise-all-é”™è¯¯å¤„ç†" class="header-anchor">#</a> Promise.all é”™è¯¯å¤„ç†</h4> <p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ Promise.all()æ‰§è¡Œå¤šä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªè¯·æ±‚å‡ºé”™ï¼Œä½†æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å…¶ä»–çš„ç½‘ç»œè¯·æ±‚ä¹Ÿè¿”å› rejectï¼Œè¦é”™éƒ½é”™ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p> <p>å¦‚ä½•åšæ‰èƒ½åšåˆ° promise.all ä¸­å³ä½¿ä¸€ä¸ª promise ç¨‹åº rejectï¼Œpromise.all ä¾ç„¶èƒ½æŠŠå…¶ä»–æ•°æ®æ­£ç¡®è¿”å›å‘¢?</p> <p>æ–¹æ¡ˆä¸€ï¼šåœ¨å¤„ç†å•ä¸ªå¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œé€šè¿‡<code>try..catch</code>å¯¹å¼‚å¸¸æƒ…å†µä¹Ÿè¿›è¡Œæ•è·ï¼Œå¼‚å¸¸åŸå› ä¹Ÿä½œä¸º resolve ç»“æœã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xxx<span class="token punctuation">.</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, ReferenceError: xxx is not defined at file, 3]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æ–¹æ¡ˆäºŒï¼šé€šè¿‡ promise çš„ catch æ•è·ï¼Œå¹¶ä¸” return é”™è¯¯ä¿¡æ¯</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  [1, &quot;error&quot;, 3]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="promise-all-æ‰‹å†™åŸç†å®ç°"><a href="#promise-all-æ‰‹å†™åŸç†å®ç°" class="header-anchor">#</a> Promise.all æ‰‹å†™åŸç†å®ç°</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">PromiseAll</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// promisesä¹Ÿä¸ä¸€å®šä¸ºæ•°ç»„ï¼Œä½†å¿…é¡»ä¸ºå¯è¿­ä»£å¯¹è±¡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;argument must be an array&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> len <span class="token operator">=</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¹Ÿå¯ä»¥é€šè¿‡for..oféå†</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promises<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æµ‹è¯•ä¾‹å­</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">PromiseAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  [1, &quot;error&quot;, 3]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_010-promise-allsettled-çš„ç”¨æ³•ä»¥åŠæ‰‹å†™åŸç†å®ç°"><a href="#_010-promise-allsettled-çš„ç”¨æ³•ä»¥åŠæ‰‹å†™åŸç†å®ç°" class="header-anchor">#</a> 010ï¼š Promise.allSettled çš„ç”¨æ³•ä»¥åŠæ‰‹å†™åŸç†å®ç°</h2> <p>Promise.allSettled ç”¨æ³•ç±»ä¼¼äº Promise.allï¼Œæ¥å—ä¸€ä¸ªç”± promise å¼‚æ­¥ä»»åŠ¡ç»„æˆçš„æ•°ç»„ï¼Œå¹¶æ”¯æŒåŒæ—¶å¤„ç†å¤šä¸ª promise å¼‚æ­¥ä»»åŠ¡ã€‚</p> <p>å’Œ all çš„åŒºåˆ«å°±æ˜¯ï¼Œä¸ç®¡å…¶ä¸­çš„ promise å…ƒç´ å¤±è´¥è¿˜æ˜¯æˆåŠŸï¼Œéƒ½ä¼šè¢« resolveï¼Œè§¦å‘ then çš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œç»“æœç”±åŒ…å«æ¯ä¸ª promise çš„ status å’Œ result/reason å¯¹è±¡ç»„æˆã€‚</p> <p>ç”¨æ³•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;promise1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;promise2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;promise3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise4 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;promise4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">,</span> promise3<span class="token punctuation">,</span> promise4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
  3000msåè¾“å‡ºï¼š

  result: 
  [
	{status: &quot;rejected&quot;, reason: &quot;promise1&quot;},
	{status: &quot;fulfilled&quot;, value: &quot;promise2&quot;},
	{status: &quot;fulfilled&quot;, value: &quot;promise3&quot;},
	{status: &quot;rejected&quot;, reason: &quot;promise4&quot;}
  ]*/</span>
</code></pre></div><p>æ‰‹å†™å®ç°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">PromiseAllSettled</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promises<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> resultItem <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&quot;fulfilled&quot;</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">result</span><span class="token operator">:</span> res<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>

                    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> resultItem<span class="token punctuation">;</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> resultItem <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&quot;rejected&quot;</span><span class="token punctuation">,</span>
                        reason<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>

                    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> resultItem<span class="token punctuation">;</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æµ‹è¯•ä¾‹å­</span>
<span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;promise1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;promise2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;promise3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise4 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;promise4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">PromiseAllSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">,</span> promise3<span class="token punctuation">,</span> promise4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>
    <span class="token parameter">args</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
  result: 
  [
	{status: &quot;rejected&quot;, reason: &quot;promise1&quot;},
	{status: &quot;fulfilled&quot;, value: &quot;promise2&quot;},
	{status: &quot;fulfilled&quot;, value: &quot;promise3&quot;},
	{status: &quot;rejected&quot;, reason: &quot;promise4&quot;}
  ]*/</span>
</code></pre></div><h2 id="_011-promise-ä¸²è¡Œå’Œå¹¶è¡Œçš„å®ç°"><a href="#_011-promise-ä¸²è¡Œå’Œå¹¶è¡Œçš„å®ç°" class="header-anchor">#</a> 011ï¼š Promise ä¸²è¡Œå’Œå¹¶è¡Œçš„å®ç°</h2> <h4 id="ä¸²è¡Œæ–¹æ¡ˆ"><a href="#ä¸²è¡Œæ–¹æ¡ˆ" class="header-anchor">#</a> ä¸²è¡Œæ–¹æ¡ˆ</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æµ‹è¯•ç”¨ä¾‹</span>
<span class="token comment">// å½“ä¸Šä¸€ä¸ª Promise å¼€å§‹æ‰§è¡Œï¼Œå½“å…¶æ‰§è¡Œå®Œæ¯•åå†è°ƒç”¨ä¸‹ä¸€ä¸ª Promiseï¼Œå¹¶ä½œä¸ºä¸€ä¸ªæ–° Promise è¿”å›ï¼Œä¸‹æ¬¡è¿­ä»£å°±ä¼šç»§ç»­è¿™ä¸ªå¾ªç¯ã€‚</span>
<span class="token keyword">const</span> <span class="token function-variable function">createPromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">runPromises</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡ºé¡ºåº</span>
<span class="token comment">// promise 1</span>
<span class="token comment">// promise 2</span>
<span class="token comment">// promise 3</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Array.prototype.reduce + promise.then</span>
<span class="token keyword">const</span> <span class="token function-variable function">runPromises</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    promiseArr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevPromise<span class="token punctuation">,</span> curPromise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> prevPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">curPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// for+async/awaitç‰ˆæœ¬</span>
<span class="token keyword">const</span> <span class="token function-variable function">runPromises</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> promise <span class="token keyword">of</span> promiseArr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="å¹¶è¡Œæ–¹æ¡ˆ"><a href="#å¹¶è¡Œæ–¹æ¡ˆ" class="header-anchor">#</a> å¹¶è¡Œæ–¹æ¡ˆ</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æµ‹è¯•ç”¨ä¾‹</span>
<span class="token keyword">const</span> <span class="token function-variable function">createPromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;promise&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">runPromises</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡ºé¡ºåº</span>
<span class="token comment">// promise 3</span>
<span class="token comment">// promise 2</span>
<span class="token comment">// promise 1</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ¨¡æ‹Ÿpromise.allSettledå®ç°</span>
<span class="token keyword">const</span> <span class="token function-variable function">runPromises</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promiseArr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> len <span class="token operator">=</span> promiseArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">result</span><span class="token operator">:</span> res<span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&quot;fulfilled&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">reason</span><span class="token operator">:</span> res<span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">&quot;rejected&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_012-promise-é™åˆ¶å¹¶è¡Œè°ƒåº¦å™¨"><a href="#_012-promise-é™åˆ¶å¹¶è¡Œè°ƒåº¦å™¨" class="header-anchor">#</a> 012ï¼š Promise é™åˆ¶å¹¶è¡Œè°ƒåº¦å™¨</h2> <p>é¢˜ç›®ï¼šç°æœ‰ 8 ä¸ªå›¾ç‰‡èµ„æºçš„ urlï¼Œå·²ç»å­˜å‚¨åœ¨æ•°ç»„ urls ä¸­ï¼Œä¸”å·²æœ‰ä¸€ä¸ªå‡½æ•° function loadingï¼Œè¾“å…¥ä¸€ä¸ª url é“¾æ¥ï¼Œè¿”å›ä¸€ä¸ª Promiseã€‚è¯¥ Promise åœ¨å›¾ç‰‡ä¸‹è½½å®Œæˆçš„æ—¶å€™ resolveï¼Œä¸‹è½½å¤±è´¥åˆ™ rejectã€‚ è¦æ±‚ï¼šä»»ä½•æ—¶åˆ»åŒæ—¶ä¸‹è½½çš„é“¾æ¥æ•°é‡ä¸å¯ä»¥è¶…è¿‡ 3 ä¸ªã€‚ è¯·å†™ä¸€æ®µä»£ç å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å°½å¯èƒ½å¿«é€Ÿåœ°å°†æ‰€æœ‰å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> urls <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/getImgData/getImgDatadata.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/getImgData/gray.gif&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/getImgData/Particle.gif&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/getImgData/arithmetic.png&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/getImgData/arithmetic2.gif&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/getImgData/getImgDataError.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/getImgData/arithmetic.gif&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;https://www.kkkk1000.com/images/wxQrCode2.png&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸€å¼ å›¾ç‰‡åŠ è½½å®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// é¢˜ç›®çš„æ„æ€æ˜¯éœ€è¦å…ˆå¹¶å‘è¯·æ±‚3å¼ å›¾ç‰‡ï¼Œå½“ä¸€å¼ å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œåˆä¼šç»§ç»­å‘èµ·ä¸€å¼ å›¾ç‰‡çš„è¯·æ±‚ï¼Œè®©å¹¶å‘æ•°ä¿æŒåœ¨3ä¸ªï¼Œç›´åˆ°éœ€è¦åŠ è½½çš„å›¾ç‰‡éƒ½å…¨éƒ¨å‘èµ·è¯·æ±‚ã€‚</span>
<span class="token keyword">function</span> <span class="token function">fetchImgWithLimit</span><span class="token punctuation">(</span><span class="token parameter">urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> limit <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> handlerFn <span class="token operator">=</span> loadImg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> allPromises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ç”¨æ¥å­˜å‚¨æ‰€æœ‰çš„Promiseä»»åŠ¡</span>
    <span class="token keyword">const</span> executing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¾¹ç•Œå¤„ç†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>urls<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// å¤„ç†ä¸€ä¸ª ç§»é™¤ä¸€ä¸ª</span>
        <span class="token keyword">const</span> url <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¢«ä½œä¸ºä¸€ä¸ªä»»åŠ¡å­˜å‚¨</span>
        <span class="token keyword">const</span> promiseItem <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handlerFn</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¯·æ±‚å›¾ç‰‡å®Œæ¯•åä»executingé˜Ÿåˆ—ä¸­ç§»é™¤</span>
                executing<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>executing<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>promiseItem<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        allPromises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promiseItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executing<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promiseItem<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> cur <span class="token operator">=</span>
            executing<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> limit
                <span class="token operator">?</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>executing<span class="token punctuation">)</span>
                <span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> cur<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>allPromises<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">fetchImgWithLimit</span><span class="token punctuation">(</span>urls<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> loadImg<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;all loaded success&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;loaded error&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_013-promise-all-æ•è·é”™è¯¯"><a href="#_013-promise-all-æ•è·é”™è¯¯" class="header-anchor">#</a> 013ï¼š Promise.all æ•è·é”™è¯¯</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> ok <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">;</span> <span class="token comment">// æ¨¡æ‹ŸæˆåŠŸæˆ–å¤±è´¥</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;get data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­£å¸¸çš„reject</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•1</span>
<span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸šåŠ¡é€»è¾‘...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•2-æ–¹æ³•1çš„å°è£…</span>
<span class="token keyword">const</span> <span class="token function-variable function">getPromiseResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> promiseArr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// ä¸šåŠ¡é€»è¾‘...</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// allSettled</span>
Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">,</span> promise3<span class="token punctuation">,</span> promise4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>
    <span class="token parameter">args</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
  result: 
  [
    {&quot;status&quot;:&quot;rejected&quot;,&quot;reason&quot;:&quot;promise1&quot;}, 
    {&quot;status&quot;:&quot;fulfilled&quot;,&quot;value&quot;:&quot;promise2&quot;},
    {&quot;status&quot;:&quot;fulfilled&quot;,&quot;value&quot;:&quot;promise3&quot;}, 
    {&quot;status&quot;:&quot;rejected&quot;,&quot;reason&quot;:&quot;promise4&quot;}
  ]*/</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_014-async-await-æ•è·é”™è¯¯"><a href="#_014-async-await-æ•è·é”™è¯¯" class="header-anchor">#</a> 014ï¼š async/await æ•è·é”™è¯¯</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;getdata success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;getdata error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ–¹æ³•1</span>
<span class="token comment">// ç¼ºç‚¹ï¼šå¦‚æœæœ‰å¤šä¸ªtestAwaitï¼Œéœ€è¦å¤šä¸ªtry..catchï¼Œä»£ç å†—ä½™ï¼</span>
<span class="token keyword">const</span> <span class="token function-variable function">testAwait1</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//getdata error</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•2</span>
<span class="token comment">// ç¼ºç‚¹ï¼šresæŠŠé”™è¯¯çš„ç»“æœå’Œæ­£ç¡®çš„ç»“æœéƒ½æ··åœ¨ä¸€èµ·äº†ï¼Œéœ€è¦é¢å¤–åˆ¤æ–­</span>
<span class="token keyword">const</span> <span class="token function-variable function">testAwait2</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> r<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//getdata error</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•3ï¼Œå¯¹å¼‚æ­¥ä»»åŠ¡é”™è¯¯æ•è·å°è£…</span>
<span class="token keyword">const</span> <span class="token function-variable function">awaitWraper</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> error<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>res<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> error<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">testAwait3</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>res<span class="token punctuation">,</span> error<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">awaitWraper</span><span class="token punctuation">(</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//null</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//getdata error</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1470715</p> <h2 id="_015-es6-class-å®ç°åŸç†-babel-æ˜¯å¦‚ä½•ç¼–è¯‘-class-çš„"><a href="#_015-es6-class-å®ç°åŸç†-babel-æ˜¯å¦‚ä½•ç¼–è¯‘-class-çš„" class="header-anchor">#</a> 015ï¼š ES6 Class å®ç°åŸç†ï¼ˆBabel æ˜¯å¦‚ä½•ç¼–è¯‘ class çš„ï¼‰</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/fragments/JavaScript Algorithms.html" class="prev">
        ğŸŒµ JavaScript åŸºç¡€ç®—æ³•
      </a></span> <span class="next"><a href="/fragments/CSS.html">
        ğŸŒµ CSS
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.42c8c4d7.js" defer></script><script src="/assets/js/2.fefa3fa1.js" defer></script><script src="/assets/js/1.67a15f5a.js" defer></script><script src="/assets/js/74.adc93296.js" defer></script>
  </body>
</html>
