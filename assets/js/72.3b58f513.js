(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{391:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"diff-ç®—æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#diff-ç®—æ³•"}},[t._v("#")]),t._v(" ğŸ‘‰ diff ç®—æ³•")]),t._v(" "),s("p",[t._v("Vue2 diff ç®—æ³•æ˜¯é€šè¿‡"),s("strong",[t._v("åŒå±‚ä¹‹é—´çš„æ ‘èŠ‚ç‚¹")]),t._v("è¿›è¡Œæ¯”è¾ƒï¼Œæ—¶é—´å¤æ‚åº¦åªæœ‰ O(n), ç®—æ˜¯ä¸€ä¸ªè¾ƒé«˜æ•ˆçš„ç®—æ³•ã€‚\næœ¬æ–‡ç« ä¸»è¦é’ˆå¯¹ Vue2 diff ç®—æ³•å±•å¼€ï¼Œæœ€åå†ç®€å•æåŠä¸€ä¸‹ä¸ Vue3 å’Œ React diff çš„åŒºåˆ«ã€‚")]),t._v(" "),s("h2",{attrs:{id:"why-diff"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#why-diff"}},[t._v("#")]),t._v(" why diff")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ•°æ®å˜åŒ–ï¼Œvue å¦‚ä½•æ›´æ–°èŠ‚ç‚¹\nä¼šå…ˆæ ¹æ®çœŸå®çš„ DOM èŠ‚ç‚¹ç»“æ„ç”Ÿæˆ virtual DOMï¼Œå½“ virtual DOM æŸä¸ªèŠ‚ç‚¹çš„æ•°æ®æ”¹å˜åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°è™šæ‹ŸèŠ‚ç‚¹ vnodeã€‚\nè§¦å‘ set æ–¹æ³•åï¼Œæ¶ˆæ¯å‘å¸ƒå™¨ Dep è°ƒç”¨ Dep.notify é€šçŸ¥æ‰€æœ‰è®¢é˜…è€… watcherï¼Œè®¢é˜…è€…çš„å›è°ƒå‡½æ•° "),s("code",[t._v("vm.update(vm.render())")]),t._v("ï¼Œ"),s("code",[t._v("vm.render()")]),t._v("å°±æ˜¯ç”Ÿæˆçš„æ–° vnodeï¼Œ "),s("code",[t._v("vm.update(ï¼‰")]),t._v("å°±ä¼šå¸¦ç€æ–° vnodeï¼Œå’Œæ—§è™šæ‹ŸèŠ‚ç‚¹ oldVNode ä½œå¯¹æ¯”ï¼Œç»™çœŸå®çš„ DOM æ‰“è¡¥ä¸ï¼Œæœ€åæ›´æ–°ç›¸åº”çš„è§†å›¾ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("virtual DOM å’ŒçœŸå® DOM åŒºåˆ«")]),t._v(" "),s("p",[t._v("ä½¿ç”¨ document.CreateElement å’Œ document.CreateTextNode åˆ›å»ºçš„å°±æ˜¯çœŸå®èŠ‚ç‚¹ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("virtual DOM æ˜¯å°†çœŸå®çš„ DOM çš„æ•°æ®æŠ½å–å‡ºæ¥ï¼Œä»¥å¯¹è±¡çš„å½¢å¼æ¨¡æ‹Ÿæ ‘å½¢ç»“æ„")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("div1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("p1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("p2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("å¯¹åº”ä»¥ä¸‹è™šæ‹Ÿ DOM å¯¹è±¡")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vnode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("el")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" div"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¯¹çœŸå®çš„èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œæœ¬ä¾‹ä¸­å¯¹åº”document.querySelector('#test.div1')")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tag")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//èŠ‚ç‚¹çš„æ ‡ç­¾")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div#test.div1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//èŠ‚ç‚¹çš„é€‰æ‹©å™¨")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸€ä¸ªå­˜å‚¨èŠ‚ç‚¹å±æ€§çš„å¯¹è±¡ï¼Œå¯¹åº”èŠ‚ç‚¹çš„el[prop]å±æ€§ï¼Œä¾‹å¦‚onclick , style")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¯¹åº”æ–‡æœ¬èŠ‚ç‚¹çš„textContentï¼Œå¦åˆ™ä¸ºnull")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("el")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tag")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p.p1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("el")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tag")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sel")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p.p2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å­˜å‚¨å­èŠ‚ç‚¹çš„æ•°ç»„ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹ä¹Ÿæ˜¯ vnode ç»“æ„")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("virtual DOM æœ¬è´¨æ˜¯åœ¨ JS æ“æ§ DOM çš„è¿‡ç¨‹ä¸­è¿›è¡Œä¸€ä¸ªç¼“å­˜ã€‚ä½¿ç”¨çœŸå® DOM å¯¹æ›´æ–°çš„æ•°æ®é‡ç»˜æ•´ä¸ªè§†å›¾å±‚æ˜¯ç›¸å½“æ¶ˆè€—æ€§èƒ½ï¼Œé€šè¿‡è™šæ‹Ÿ DOM å’Œ diff ç®—æ³•å¾—å‡ºä¸€äº›éœ€è¦ä¿®æ”¹çš„æœ€å°å•ä½ï¼Œå¹¶å¯¹å°å•ä½çš„ä½å›¾ä½œå‡ºå¯¹åº”çš„æ›´æ–°ï¼Œè¿™æ ·å­å¯ä»¥å‡å°‘ä¸å¿…è¦çš„ DOM æ“ä½œï¼Œä»¥æ­¤æ¥æé«˜æ€§èƒ½ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("diff æ¯”è¾ƒæ–¹å¼\n"),t._v("\nVue2 çš„ diff é€šè¿‡ patch å‡½æ•°åƒæ‰“è¡¥ä¸ä¸€æ ·ä¿®æ”¹çœŸå® DOMï¼Œæ¯”è¾ƒåªä¼šåœ¨åŒå±‚çº§è¿›è¡Œ, ä¸ä¼šè·¨å±‚çº§æ¯”è¾ƒã€‚ï¼ˆç®—æ³•æ ¸å¿ƒæ˜¯åŒçº§æ¯”è¾ƒå’ŒåŒç«¯å¯¹æ¯”ï¼‰")]),t._v(" "),s("p",[t._v("æ¯”è¾ƒæ—¶ï¼Œåœ¨åŒçº§æ¯”è¾ƒä¸­ï¼Œå®ƒä¼šåŒæ—¶ä»æ–°æ—§å­èŠ‚ç‚¹æ•°ç»„çš„å¤´å’Œå°¾å¼€å§‹ï¼Œè¿›è¡Œå››è½®å¿«é€Ÿæ¯”å¯¹ã€‚å¦‚æœè¿™å››è½®éƒ½æ²¡åŒ¹é…ä¸Šï¼Œå°±ä¼šåˆ©ç”¨æˆ‘ä»¬åœ¨ v-for ä¸­å®šä¹‰çš„ key å€¼å»æ—§èŠ‚ç‚¹é‡ŒæŸ¥æ‰¾å¯å¤ç”¨çš„èŠ‚ç‚¹ã€‚")])])]),t._v(" "),s("h2",{attrs:{id:"how-diff"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-diff"}},[t._v("#")]),t._v(" how diff")]),t._v(" "),s("p",[t._v("1ï¼‰ é€šè¿‡"),s("code",[t._v("patch")]),t._v("å¯¹åŒçº§è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åå†å¾€ä¸‹æ¯”è¾ƒå­èŠ‚ç‚¹ï¼›")]),t._v(" "),s("p",[t._v("é¦–å…ˆä¼šé€šè¿‡"),s("code",[t._v("sameNode")]),t._v("åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹çš„ "),s("code",[t._v("keyã€tagã€isCommentã€data")]),t._v(" åŒæ—¶å®šä¹‰æˆ–ä¸å®šä¹‰ä»¥åŠå½“æ ‡ç­¾ç±»å‹ä¸º input çš„æ—¶å€™çš„ "),s("code",[t._v("type")]),t._v(" ç›¸ä¸ç›¸åŒæ¥ç¡®å®šä¸¤ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯ç›¸åŒçš„èŠ‚ç‚¹ï¼š"),s("br"),t._v("\nå¦‚æœä¸æ˜¯çš„è¯å°±å°†æ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹ï¼›"),s("br"),t._v("\nå¦‚æœæ˜¯ç›¸åŒèŠ‚ç‚¹çš„è¯æ‰ä¼šè¿›å…¥åˆ° "),s("code",[t._v("patchVNode")]),t._v(" é˜¶æ®µã€‚")]),t._v(" "),s("p",[t._v("2ï¼‰"),s("code",[t._v("patchVNode")]),t._v(" é˜¶æ®µä¸­ï¼Œä¼šæœ‰å‡ ç§æƒ…å†µçš„åˆ¤æ–­ï¼š"),s("br"),t._v("\na. åˆ¤æ–­èŠ‚ç‚¹å¼•ç”¨æ˜¯å¦å®Œå…¨ä¸€è‡´ï¼Œæ˜¯åˆ™ç›´æ¥ returnï¼›")]),t._v(" "),s("p",[t._v("b. ç„¶åä¼šå¯¹æ–‡æœ¬èŠ‚ç‚¹è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹å¹¶ä¸”ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå°†çœŸå® DOM å¯¹åº”çš„æ–‡æœ¬èŠ‚ç‚¹è®¾ç½®ä¸º VNode çš„æ–‡æœ¬èŠ‚ç‚¹ï¼›")]),t._v(" "),s("p",[t._v("c. ç„¶åå†åˆ¤æ–­ä¸€æ–¹æœ‰å­èŠ‚ç‚¹å’Œä¸€æ–¹æ²¡æœ‰å­èŠ‚ç‚¹çš„æƒ…å†µï¼š"),s("br"),t._v("\nå¦‚æœæ—§çš„ä¸€æ–¹æ²¡æœ‰è€Œæ–°ä¸€æ–¹æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™æ·»åŠ åˆ›å»ºå¹¶æ·»åŠ æ–°çš„å­èŠ‚ç‚¹ï¼›"),s("br"),t._v("\nå¦‚æœæ—§çš„ä¸€æ–¹æœ‰è€Œæ–°ä¸€æ–¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™æŠŠæ—§å­èŠ‚ç‚¹åˆ é™¤ï¼›")]),t._v(" "),s("p",[t._v("d. æœ€åæ˜¯åˆ¤æ–­åŒæ–¹éƒ½å­˜åœ¨å­èŠ‚ç‚¹çš„æƒ…å†µï¼Œæ˜¯åˆ™æ‰§è¡Œ "),s("code",[t._v("updateChildren")]),t._v(" æ“ä½œã€‚")]),t._v(" "),s("p",[t._v("3ï¼‰é€šè¿‡ "),s("code",[t._v("updateChildren")]),t._v(" æ¥æ›´æ–°å­èŠ‚ç‚¹ï¼š")]),t._v(" "),s("p",[t._v("åœ¨è¿™ä¸ªé˜¶æ®µæ ¸å¿ƒæ˜¯é‡‡ç”¨"),s("code",[t._v("åŒç«¯æ¯”è¾ƒ")]),t._v("çš„ç®—æ³•ï¼ŒåŒæ—¶ä»æ–°æ—§èŠ‚ç‚¹çš„ä¸¤ç«¯è¿›è¡Œæ¯”è¾ƒã€‚"),s("br"),t._v("\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šç”¨åˆ°æ¨¡ç‰ˆç¼–è¯‘æ—¶çš„é™æ€æ ‡è®°é…åˆ key æ¥è·³è¿‡å¯¹æ¯”é™æ€èŠ‚ç‚¹ï¼ˆæ²¡æœ‰æ¶‰åŠ data æ•°æ®{{}}ï¼‰ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("æ ¸å¿ƒç­–ç•¥\n"),s("ul",[s("li",[s("strong",[t._v("åŒå±‚é™åˆ¶")]),t._v("ï¼šåªæ¯”è¾ƒåŒä¸€å±‚çº§çš„ VNodeï¼Œä¸åŒå±‚çº§ç›´æ¥é”€æ¯é‡å»ºã€‚")]),t._v(" "),s("li",[s("strong",[t._v("åŒæŒ‡é’ˆéå†ï¼Œå‘ä¸­é—´æ”¶ç¼©")]),t._v("ï¼šå¯¹æ–°æ—§ VNode åˆ—è¡¨åˆ†åˆ«è®¾ç½®oldStartIdxï¼ˆæ—§å¤´ï¼‰ã€oldEndIdxï¼ˆæ—§å°¾ï¼‰ã€newStartIdxï¼ˆæ–°å¤´ï¼‰ã€newEndIdxï¼ˆæ–°å°¾ï¼‰å››ä¸ªæŒ‡é’ˆï¼Œä¼˜å…ˆæ¯”è¾ƒé¦–å°¾èŠ‚ç‚¹ä»¥å¿«é€Ÿå¤ç”¨ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("key çš„ä½œç”¨")]),t._v("ï¼šå½“é¦–å°¾æ— æ³•åŒ¹é…æ—¶ï¼Œé€šè¿‡keyå»ºç«‹æ—§èŠ‚ç‚¹çš„ç´¢å¼•æ˜ å°„ï¼Œå¿«é€ŸæŸ¥æ‰¾å¯å¤ç”¨èŠ‚ç‚¹ã€‚")])])])]),t._v(" "),s("h2",{attrs:{id:"patch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#patch"}},[t._v("#")]),t._v(" patch")]),t._v(" "),s("p",[t._v("diff çš„è¿‡ç¨‹å°±æ˜¯è°ƒç”¨ patch å‡½æ•°ï¼Œå°±åƒæ‰“è¡¥ä¸ä¸€æ ·ä¿®æ”¹çœŸå® domã€‚")]),t._v(" "),s("p",[t._v("patch å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œvnode å’Œ oldVNodeï¼Œä¹Ÿå°±æ˜¯æ–°æ—§ä¸¤ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å‰oldVNodeå¯¹åº”çš„çœŸå®å…ƒç´ èŠ‚ç‚¹")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" oEl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// çˆ¶å…ƒç´ ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" parentEle "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parentNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oEl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ ¹æ®VNodeç”Ÿæˆæ–°å…ƒç´ ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createEle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentEle "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†æ–°å…ƒç´ æ·»åŠ è¿›çˆ¶å…ƒç´ ")]),t._v("\n            api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentEle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oEl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç§»é™¤ä»¥å‰çš„æ—§å…ƒç´ èŠ‚ç‚¹")]),t._v("\n            api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentEle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            oldVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// patchæœ€åä¼šè¿”å›vnodeï¼Œvnodeå’Œè¿›å…¥patchä¹‹å‰çš„ä¸åŒåœ¨å“ª")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"samenode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#samenode"}},[t._v("#")]),t._v(" sameNode")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n  åˆ¤æ–­ä¸¤ä¸ªVNodeèŠ‚ç‚¹æ˜¯å¦æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\n  keyç›¸åŒ\n  tagç›¸åŒï¼ˆå½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾åï¼‰\n  isCommentç›¸åŒï¼ˆæ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹ï¼‰\n  æ˜¯å¦dataéƒ½æœ‰å®šä¹‰ï¼ˆå½“å‰èŠ‚ç‚¹å¯¹åº”çš„å¯¹è±¡ï¼ŒåŒ…å«äº†å…·ä½“çš„ä¸€äº›æ•°æ®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªVNodeDataç±»å‹ï¼Œå¯ä»¥å‚è€ƒVNodeDataç±»å‹ä¸­çš„æ•°æ®ä¿¡æ¯ï¼‰\n  å½“æ ‡ç­¾æ˜¯<input>æ—¶ï¼Œtypeæ˜¯å¦ç›¸åŒ\n*/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isComment "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isComment "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameInputType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n  åˆ¤æ–­å½“æ ‡ç­¾æ˜¯<input>çš„æ—¶å€™ï¼Œtypeæ˜¯å¦ç›¸åŒ\n  æŸäº›æµè§ˆå™¨ä¸æ”¯æŒåŠ¨æ€ä¿®æ”¹<input>ç±»å‹ï¼Œæ‰€ä»¥ä»–ä»¬è¢«è§†ä¸ºä¸åŒç±»å‹\n*/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameInputType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" typeA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attrs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" typeB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attrs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" typeA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" typeB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"patchnode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#patchnode"}},[t._v("#")]),t._v(" patchNode")]),t._v(" "),s("p",[t._v("å½“ oldVNode å’Œ VNode å€¼å¾—æ¯”è¾ƒåï¼Œä¼šå¯¹ä¸¤ä¸ªèŠ‚ç‚¹æ‰§è¡Œ patchNodeï¼š")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¼•ç”¨ä¸€è‡´åˆ™ç›´æ¥è¿”å›")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" vNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘å¯¹åº”çš„çœŸå®DOM")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vnodeè¡¨ç¤ºæ–°èŠ‚ç‚¹ï¼Œæ­¤æ—¶æ˜¯æ²¡æœ‰elmå±æ€§çš„ã€‚è€Œåœ¨ç»è¿‡createElmæ–¹æ³•åï¼Œvnode.childrenä¸­çš„å­èŠ‚ç‚¹éƒ½æœ‰äº†elmå±æ€§ï¼Œæ­¤æ—¶åªæœ‰vnodeæ²¡æœ‰elmå±æ€§ï¼Œè€Œèƒ½è¿›åˆ° patchVNode æ–¹æ³•æ¥çš„æ–°æ—§èŠ‚ç‚¹ï¼Œä¸€å®šç»è¿‡äº†sameVNodeæ–¹æ³•çš„åˆ¤æ–­ï¼Œè¯´æ˜ä»–ä»¬èŠ‚ç‚¹æœ¬èº«å‡ ä¹ä¸€æ ·ï¼Œæ‰€ä»¥æ–°èŠ‚ç‚¹å¯ä»¥ç”¨æ—§èŠ‚ç‚¹çš„elm")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldCh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœä»–ä»¬éƒ½æœ‰æ–‡æœ¬èŠ‚ç‚¹å¹¶ä¸”ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå°†elçš„æ–‡æœ¬èŠ‚ç‚¹è®¾ç½®ä¸ºvnodeçš„æ–‡æœ¬èŠ‚ç‚¹")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// node.textContent = vnode.text")]),t._v("\n        api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTextContent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateEle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœoldVNodeå’Œvnodeéƒ½æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™æ‰§è¡ŒupdateChildrenï¼Œå¯¹å­èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼ˆdiffæ ¸å¿ƒï¼‰")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" oldCh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" ch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChildren")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœoldVNodeæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œè€Œvnodeæœ‰ï¼Œåˆ™å°†vodeçš„å­èŠ‚ç‚¹çœŸå®åŒ–å¹¶æ–°å¢è‡³el")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createEle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœoldVNodeæœ‰å­èŠ‚ç‚¹ï¼Œè€Œvnodeæ²¡æœ‰ï¼Œåˆ™åˆ é™¤elçš„å­èŠ‚ç‚¹")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChildren")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"updatechildren"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#updatechildren"}},[t._v("#")]),t._v(" updateChildren")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChildren")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æå– oldVNode å­èŠ‚ç‚¹çš„å¤´å°¾Idxä»¥åŠèŠ‚ç‚¹å†…å®¹ï¼Œä½œä¸ºç§»åŠ¨æŒ‡é’ˆ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldStartIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æå– newVNode å­èŠ‚ç‚¹çš„å¤´å°¾Idxä»¥åŠèŠ‚ç‚¹å†…å®¹ï¼Œä½œä¸ºç§»åŠ¨æŒ‡é’ˆ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newStartIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" oldEndIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" newStartIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" newEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¾¹ç•Œæƒ…å†µå¤„ç†")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            oldStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            oldEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEnIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            newStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            newEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‰å››ç§æƒ…å†µæ˜¯åœ¨æœ‰æŒ‡å®škeyçš„æ—¶å€™ï¼Œåˆ†åˆ«æ¯”è¾ƒoldChä»¥åŠnewChçš„ä¸¤å¤´èŠ‚ç‚¹ 2*2=4 ç§æƒ…å†µã€‚è‹¥åˆ¤å®šä¸ºåŒä¸€ä¸ªVNodeåˆ™ç›´æ¥patchVNodeã€‚")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹äº sameVNode(oldStartVNode, newStartVNode) å’Œ sameVNode(oldEndVNode,newEndVNode) ä¸º true çš„æƒ…å†µï¼Œä¸éœ€è¦å¯¹DOMè¿›è¡Œç§»åŠ¨")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. æ–°æ—§å¤´åŒ¹é…ï¼šç›´æ¥å¤ç”¨ï¼ŒæŒ‡é’ˆåç§»")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åŒ¹é…ä¸Šçš„ä¸¤ä¸ªæŒ‡é’ˆå‘ä¸­é—´ç§»åŠ¨")]),t._v("\n            oldStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            newStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. æ–°æ—§å°¾åŒ¹é…ï¼šç›´æ¥å¤ç”¨ï¼ŒæŒ‡é’ˆå‰ç§»")]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            oldEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            newEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. æ—§å¤´æ–°å°¾åŒ¹é…ï¼šå¤ç”¨å¹¶ç§»åŠ¨åˆ°å°¾éƒ¨")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//è‹¥oldStartVNodeå’ŒnewEndVNodeåŒ¹é…ä¸Šäº†ï¼Œè¯´æ˜çœŸå®DOMçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¼šè¢«ç§»åŠ¨æœ€å")]),t._v("\n            api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            oldStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            newEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. æ—§å°¾æ–°å¤´åŒ¹é…ï¼šå¤ç”¨å¹¶ç§»åŠ¨åˆ°å¤´éƒ¨")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è‹¥oldEndVNodeå’ŒnewStartVNodeåŒ¹é…ä¸Šäº†ï¼Œè¯´æ˜çœŸå®DOMçš„æœ€åå­èŠ‚ç‚¹ä¼šè¢«ç§»åŠ¨æœ€å‰")]),t._v("\n            api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            oldEndVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            newStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5. é¦–å°¾å‡ä¸åŒ¹é…ï¼šé€šè¿‡keyæ˜ å°„æŸ¥æ‰¾å¯å¤ç”¨èŠ‚ç‚¹")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ ¹æ®æ‰€æœ‰æ—§å­èŠ‚ç‚¹çš„keyç”Ÿæˆå“ˆå¸Œè¡¨ï¼Œkeyä¸ºoldVNodeçš„keyï¼Œvalueä¸ºå¯¹åº”indexåºåˆ—çš„å“ˆå¸Œè¡¨ï¼ˆæ‰€æœ‰æ—§å­èŠ‚ç‚¹çš„ key æ˜ å°„åˆ°æ—§èŠ‚ç‚¹ä¸‹æ ‡ï¼‰ã€‚")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰€æœ‰æ—§å­èŠ‚ç‚¹çš„ key æ˜ å°„åˆ°æ—§èŠ‚ç‚¹ä¸‹æ ‡ï¼Œç„¶åç”¨æ–°vnodeçš„keyå»æ‰¾å‡ºåœ¨æ—§èŠ‚ç‚¹ä¸­å¯ä»¥å¤ç”¨çš„ä½ç½®ã€‚")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¯”å¦‚oldChæ˜¯è¿™æ ·çš„ [{xx: xx, key: 'key0'}, {xx: xx, key: 'key1'}, {xx: xx, key: 'key2'}]ï¼ŒoldStartIdx = 0ï¼ŒoldEndIdx = 2")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å­˜å‚¨æ‰€æœ‰æ—§å­èŠ‚ç‚¹çš„Key -> indexçš„å“ˆå¸Œè¡¨ï¼Œç”Ÿæˆ {key0: 0, key1: 1, key2: 2}")]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" oldKeyToIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createKeyToOldIdx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ–°èŠ‚ç‚¹åŒ¹é…æ—§å­èŠ‚ç‚¹ä¸­çš„indexï¼Œå³åœ¨æ—§èŠ‚ç‚¹ä¸­åŒ¹é…å¯å¤ç”¨çš„ä½ç½®")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" idxInOld "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldKeyToIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ— åŒ¹é…èŠ‚ç‚¹åˆ™åˆ›å»ºæ–°èŠ‚ç‚¹ï¼ŒnewStartVNodeæ²¡æœ‰key æˆ– è¯¥keyæ²¡æœ‰åœ¨è€èŠ‚ç‚¹ä¸­åŒ¹é…ä¸Šï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹æ’å…¥è‡³oldStartVNodeå¯¹åº”ä½ç½®")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("idxInOld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åŒ¹é…ä¸Šäº†ï¼Œåˆ™è·å–åŒkeyçš„æ—§å­èŠ‚ç‚¹,ç§»åŠ¨åˆ°å½“å‰ä½ç½®")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vnodeToMove "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›¸åŒkeyï¼Œè¿˜è¦åˆ¤æ–­å’ŒåŒ¹é…èŠ‚ç‚¹æ˜¯å¦ä¸ºsameVNode")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnodeToMove"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›¸åŒkeyä½†ä¸æ˜¯sameVNodeçš„æ—¶å€™ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ’å…¥è‡³oldStartVNode.elçš„å‰è¾¹ã€‚")]),t._v("\n                    api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createEle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›¸åŒkeyä¸”æ˜¯sameVNodeçš„æ—¶å€™ï¼Œåˆ™å°†æ–°èŠ‚ç‚¹æ’å…¥ï¼ŒåŒæ—¶å¾€ä¸‹patchVNodeï¼Œå¹¶æŠŠåŒ¹é…ä¸Šçš„æ—§å­èŠ‚ç‚¹è®¾ç½®ä¸ºnull")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pathVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnodeToMove"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnodeToMove"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            \n            newStartVNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¤„ç†å‰©ä½™èŠ‚ç‚¹ï¼ˆæ–°å¢æˆ–åˆ é™¤ï¼‰")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åœ¨æ¯”è¾ƒçš„è¿‡ç¨‹ä¸­ï¼Œå˜é‡ä¼šå¾€ä¸­é—´é ï¼Œä¸€æ—¦StartIdx>EndIdxè¡¨æ˜oldChå’ŒnewChè‡³å°‘æœ‰ä¸€ä¸ªå·²ç»éå†å®Œäº†ï¼Œå°±ä¼šç»“æŸæ¯”è¾ƒã€‚")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" oldEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// oldChå…ˆéå†å®Œï¼Œåˆ™è¯æ˜å‰©ä¸‹çš„newChèŠ‚ç‚¹æ˜¯æ–°å¢çš„ï¼ˆnewStartIdxå’ŒnewEndIdxä¹‹é—´çš„vnodeï¼‰ï¼Œè°ƒç”¨addVNodeså°†å…¶æ‹†å…¥è‡³beforeåé¢")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" before "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addVNodes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" before"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" newEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// newChå…ˆéå†å®Œï¼Œåˆ™åœ¨çœŸå®DOMä¸­å°†[oldStartIdx, oldEndIdx]çš„å¤šä½™èŠ‚ç‚¹åˆ é™¤")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeVNodes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),t._v(" "),s("h2",{attrs:{id:"vue3-diff-ç®—æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue3-diff-ç®—æ³•"}},[t._v("#")]),t._v(" Vue3 diff ç®—æ³•")]),t._v(" "),s("p",[t._v("åœ¨ Vue2 ä¸­ï¼Œdiff ç®—æ³•æ˜¯åŸºäºåŒå±‚æ¯”è¾ƒå’ŒåŒç«¯å¯¹æ¯”è¿›è¡Œçš„ã€‚")]),t._v(" "),s("p",[t._v("åœ¨ Vue3 ä¸­ï¼Œdiff ç®—æ³•åˆ™æ˜¯åŒç«¯å¯¹æ¯”ï¼Œå‰ç¼€ + åç¼€ + LIS ä¼˜åŒ–ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("åœ¨ key æ˜ å°„åŒ¹é…æ­¥éª¤ä¸­ï¼Œå¼•å…¥äº†**æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰**ç®—æ³•æ¥è¿›ä¸€æ­¥å‡å°‘èŠ‚ç‚¹ç§»åŠ¨æ¬¡æ•°ï¼Œè¿™ä¸ªå­åºåˆ—ä»£è¡¨çš„èŠ‚ç‚¹æ˜¯ç›¸å¯¹ä½ç½®æ²¡æœ‰å˜åŒ–çš„ï¼Œåªéœ€è¦ç§»åŠ¨ä¸åœ¨è¿™ä¸ªå­åºåˆ—ä¸­çš„èŠ‚ç‚¹å³å¯ã€‚")]),t._v(" "),s("li",[t._v("åŒæ—¶ä¹Ÿå¢åŠ äº†"),s("strong",[t._v("ç¼–è¯‘æ—¶ä¼˜åŒ–")]),t._v("ï¼š\n"),s("ul",[s("li",[t._v("é™æ€æå‡ï¼šåœ¨ç¼–è¯‘é˜¶æ®µå°†é™æ€èŠ‚ç‚¹æå‡åˆ° render å¤–ï¼Œå‡å°‘è¿è¡Œæ—¶å¯¹æ¯”å¼€é”€")]),t._v(" "),s("li",[t._v("Patch Flagsï¼šæ ‡è®°åŠ¨æ€èŠ‚ç‚¹ï¼Œæ¯”å¦‚ç»‘å®šäº†æ•°æ®èŠ‚ç‚¹æˆ–è€…å±æ€§ï¼Œç²¾å‡†å¯¹æ¯”æ ‡è®°è¿‡çš„èŠ‚ç‚¹")])])])]),t._v(" "),s("p",[t._v("vue3 diff çš„æ ¸å¿ƒç­–ç•¥ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åˆ†é˜¶æ®µå¤„ç†ï¼šåŒç«¯å¯¹æ¯”ï¼š\n"),s("ul",[s("li",[t._v("å…ˆåŒ¹é…å‰ç¼€ç›¸åŒèŠ‚ç‚¹ï¼ˆç›´æ¥å¤ç”¨ï¼ŒæŒ‡é’ˆåç§»ï¼‰ã€‚")]),t._v(" "),s("li",[t._v("å†åŒ¹é…åç¼€ç›¸åŒèŠ‚ç‚¹ï¼ˆç›´æ¥å¤ç”¨ï¼ŒæŒ‡é’ˆå‰ç§»ï¼‰ã€‚")])])]),t._v(" "),s("li",[t._v("ä¸­é—´ä¹±åºå¤„ç†ï¼š\n"),s("ul",[s("li",[t._v("å¯¹å‰©ä½™èŠ‚ç‚¹ï¼Œç”¨keyå»ºç«‹æ–°èŠ‚ç‚¹åˆ°ç´¢å¼•çš„æ˜ å°„ã€‚")]),t._v(" "),s("li",[t._v("ç”Ÿæˆ â€œæ–°èŠ‚ç‚¹åœ¨æ—§åˆ—è¡¨ä¸­çš„ç´¢å¼•â€ æ•°ç»„ï¼Œè®¡ç®—å…¶ LISï¼ˆæ‰¾å‡ºæ— éœ€ç§»åŠ¨èŠ‚ç‚¹åºåˆ—ï¼Œå…¶ä»–èŠ‚ç‚¹æ‰ç§»åŠ¨ï¼‰ã€‚")]),t._v(" "),s("li",[t._v("éå†æ—§æ•°ç»„ï¼Œæ ¹æ® LIS ç»“æœåˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨èŠ‚ç‚¹ï¼Œä¸åœ¨ LIS ä¸­çš„èŠ‚ç‚¹éœ€è¦ç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®ã€‚ï¼ˆå‰©ä½™èŠ‚ç‚¹æ ¹æ® LIS ä½ç½®ç§»åŠ¨ï¼Œå‡å°‘æ“ä½œæ¬¡æ•°ã€‚ï¼‰")])])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// packages/runtime-core/src/renderer.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patchKeyedChildren")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("c1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" e1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. å¤„ç†å‰ç¼€ç›¸åŒèŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" e1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" e2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSameVNodeType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. å¤„ç†åç¼€ç›¸åŒèŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" e1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" e2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSameVNodeType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("e1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("e2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("e1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("e2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    e1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    e2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. æ—§èŠ‚ç‚¹å¤„ç†å®Œï¼Œæ–°å¢å‰©ä½™æ–°èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" e1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* æ–°å¢é€»è¾‘ */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. æ–°èŠ‚ç‚¹å¤„ç†å®Œï¼Œåˆ é™¤å‰©ä½™æ—§èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" e2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* åˆ é™¤é€»è¾‘ */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5. å¤„ç†ä¸­é—´ä¹±åºèŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" s1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å»ºç«‹æ–°èŠ‚ç‚¹keyåˆ°ç´¢å¼•çš„æ˜ å°„")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" keyToNewIndexMap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" e2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" keyToNewIndexMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éå†æ—§åˆ—è¡¨ï¼Œè®°å½•æ–°èŠ‚ç‚¹åœ¨æ—§åˆ—è¡¨ä¸­çš„ç´¢å¼•ï¼ˆ0è¡¨ç¤ºæ–°å¢ï¼‰")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newIndexToOldIndexMap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" s2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fill")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" moved "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" maxNewIndexSoFar "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" s1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" e1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" oldKey "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" keyToNewIndexMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        newIndexToOldIndexMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +1é¿å…0")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" maxNewIndexSoFar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" maxNewIndexSoFar "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" moved "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å­˜åœ¨éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* åˆ é™¤æ— åŒ¹é…çš„æ—§èŠ‚ç‚¹ */")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¡ç®—LISï¼ˆæ— éœ€ç§»åŠ¨çš„èŠ‚ç‚¹ï¼‰")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" increasingNewIndexSequence "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" moved "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSequence")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newIndexToOldIndexMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" increasingNewIndexSequence"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä»åå¾€å‰å¤„ç†æ–°èŠ‚ç‚¹ï¼Œç§»åŠ¨æˆ–æ–°å¢")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" e2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" c2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" s2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newIndexToOldIndexMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* æ–°å¢èŠ‚ç‚¹ */")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moved "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" newIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" increasingNewIndexSequence"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("lastIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ç§»åŠ¨èŠ‚ç‚¹åˆ°æ­£ç¡®ä½ç½® */")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          lastIndex"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// LISèŠ‚ç‚¹æ— éœ€ç§»åŠ¨")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),t._v(" "),s("h2",{attrs:{id:"react-diff-ç®—æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-diff-ç®—æ³•"}},[t._v("#")]),t._v(" React diff ç®—æ³•")]),t._v(" "),s("p",[t._v("React çš„ diff åŸºäº Fiber æ¶æ„ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å¯ä¸­æ–­æ€§ï¼ˆæ—¶é—´åˆ†ç‰‡ï¼‰ï¼Œç®—æ³•è®¾è®¡æ›´ç®€å•ï¼Œä¼˜å…ˆä¿è¯ UI å“åº”é€Ÿåº¦ã€‚")]),t._v(" "),s("p",[t._v("å› ä¸º Fiber æ ‘æ˜¯å•é“¾è¡¨ç»“æ„ï¼Œæ²¡æœ‰å­èŠ‚ç‚¹æ•°ç»„æ•°æ®ç»“æ„ï¼Œä¹Ÿæ²¡æœ‰åå‘æŒ‡é’ˆï¼Œä¹Ÿå°±æ²¡æœ‰å¯ä»¥ä¾›ä¸¤ç«¯åŒæ—¶æ¯”è¾ƒçš„å°¾éƒ¨æ¸¸æ ‡ã€‚æ‰€ä»¥Reactçš„è¿™ä¸ªç®—æ³•æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¸¤ç«¯æ¯”è¾ƒæ³•ï¼Œåªä»å¤´éƒ¨å¼€å§‹æ¯”è¾ƒã€‚")]),t._v(" "),s("p",[t._v("React diff é‡‡ç”¨å•å‘é€’å½’æ¯”è¾ƒï¼Œå®ƒé»˜è®¤ä»å·¦åˆ°å³éå†æ–°åˆ—è¡¨ï¼Œä¾é  "),s("strong",[t._v("key å’ŒèŠ‚ç‚¹ç±»å‹")]),t._v("æ¥è¯†åˆ«å¯å¤ç”¨çš„èŠ‚ç‚¹ã€‚å…¶ç®—æ³•å®ç°ç›¸å¯¹ç®€å•ï¼Œå¯é¢„æµ‹æ€§å¼ºã€‚")]),t._v(" "),s("p",[t._v("å…¶è®¾è®¡æ€è·¯ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åˆ†å±‚ï¼ŒåŒå±‚æ¯”è¾ƒï¼šå°† DOM æ ‘åˆ†ä¸ºå¤šä¸ªå±‚çº§ï¼Œç„¶åé€å±‚æ¯”è¾ƒï¼Œåªæ¯”è¾ƒåŒä¸€å±‚çº§çš„èŠ‚ç‚¹ï¼Œä»è€Œå‡å°‘æ¯”è¾ƒçš„å¤æ‚åº¦ã€‚åŒçº§æ¯”è¾ƒæ—¶æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œæ¯”è¾ƒã€‚")]),t._v(" "),s("li",[t._v("èŠ‚ç‚¹ç±»å‹ä¼˜å…ˆï¼šä¸¤ä¸ªä¸åŒç±»å‹çš„å…ƒç´ ä¼šç”Ÿæˆä¸åŒçš„æ ‘ï¼Œå¦‚æœå…ƒç´ ç±»å‹å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact ä¼šé”€æ¯æ—§æ ‘å¹¶åˆ›å»ºæ–°æ ‘ï¼›ç›¸åŒç±»å‹å¤ç”¨èŠ‚ç‚¹ï¼Œæ¯”è¾ƒå±æ€§ï¼Œç„¶åé€’å½’æ¯”è¾ƒå­èŠ‚ç‚¹ï¼›")]),t._v(" "),s("li",[t._v("ä¾èµ– Key å±æ€§è¿›è¡Œæ¯”è¾ƒï¼š\n"),s("ul",[s("li",[t._v("ä¾èµ– key è¯†åˆ«å¯å¤ç”¨èŠ‚ç‚¹ï¼ˆæ—  key æ—¶æŒ‰ç´¢å¼•æ¯”è¾ƒï¼Œå¯èƒ½å¯¼è‡´çŠ¶æ€é”™ä¹±ï¼‰ã€‚")]),t._v(" "),s("li",[t._v("ä»å·¦åˆ°å³éå†æ–°åˆ—è¡¨ï¼Œç”¨ lastPlacedIndex æ ‡è®°å·²å¤„ç†èŠ‚ç‚¹çš„æœ€å¤§æ—§ç´¢å¼•ï¼š\n"),s("ul",[s("li",[t._v("è‹¥æ–°èŠ‚ç‚¹çš„æ—§ç´¢å¼• â‰¤ lastPlacedIndexï¼Œåˆ™éœ€è¦ç§»åŠ¨ï¼›å¦åˆ™æ›´æ–° lastPlacedIndexã€‚")])])])])])]),t._v(" "),s("p",[t._v("React çš„ diff ç®—æ³•ç®€è¿°ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ç¬¬ä¸€è½®éå† newChildrenï¼šå¤„ç†å¯å¤ç”¨çš„èŠ‚ç‚¹")]),t._v(" "),s("ul",[s("li",[t._v("ä»å¤´å¼€å§‹éå† newChildren ï¼Œé€ä¸ªä¸ oldFiber é“¾ä¸­çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­ DOM èŠ‚ç‚¹æ˜¯å¦å¯å¤ç”¨ã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœèŠ‚ç‚¹çš„ key ä¸åŒï¼Œåˆ™ä¸å¯å¤ç”¨ï¼Œç›´æ¥è·³å‡ºå¾ªç¯ï¼Œç¬¬ä¸€è½®éå†ç»“æŸã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœ key ç›¸åŒï¼Œä½†æ˜¯ type ä¸åŒï¼Œåˆ™ä¼šé‡æ–°é—¯è¿›æ–° fiberï¼Œå°† oldFiber æ ‡è®°ä¸º Deletion åç»­åˆ é™¤ï¼Œå¹¶ç»§ç»­éå†ã€‚\n")]),t._v(" "),s("li",[t._v("ç„¶åæ¯”è¾ƒ oldFiber.Index æ˜¯å¦å°äº lastPlacedIndex å¦‚æœæ˜¯ï¼Œè¯´æ˜è¿™ä¸ªèŠ‚ç‚¹åœ¨æ–°é›†åˆä¸­éœ€è¦å‘å³ç§»åŠ¨ï¼Œæ ‡è®°ä¸º Placement ï¼Œå¹¶æ›´æ–° lastPlacedIndexï¼›å¦åˆ™åˆ™ä¸ç”¨ç§»åŠ¨ã€‚")])])]),t._v(" "),s("li",[s("p",[t._v("ç¬¬ä¸€è½® newChildren éå†å·²å®Œæˆï¼Œæ–°èŠ‚ç‚¹å·²ç»éå†å®Œæˆï¼Œå¦‚æœè¿˜å‰©è€èŠ‚ç‚¹ï¼Œåˆ™å°†å‰©ä¸‹è€èŠ‚ç‚¹ç›´æ¥åˆ é™¤ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœè€èŠ‚ç‚¹æ²¡æœ‰äº†ï¼Œæ–°èŠ‚ç‚¹è¿˜æœ‰ æˆ–è€… åˆæ¬¡æ¸²æŸ“ï¼Œå°±ç›´æ¥æ’å…¥ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœæ–°æ—§èŠ‚ç‚¹éƒ½è¿˜æœ‰ï¼Œå°±è¿›è¡Œç¬¬äºŒæ¬¡éå†ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æŠŠ oldFiber æŒ‰ç…§ key  æˆ–è€… index æ”¾åˆ°Map é‡Œï¼Œç„¶åéå†æ–°çš„ Fiberï¼Œè¿›è¡ŒåŒ¹é…å¤ç”¨ã€‚")]),t._v(" "),s("li",[t._v("ç„¶åæ¯”è¾ƒ oldFiber.Index æ˜¯å¦å°äº lastPlacedIndex å¦‚æœæ˜¯ï¼Œè¯´æ˜è¿™ä¸ªèŠ‚ç‚¹åœ¨æ–°é›†åˆä¸­éœ€è¦å‘å³ç§»åŠ¨ï¼Œæ ‡è®°ä¸º Placement ï¼Œå¹¶æ›´æ–° lastPlacedIndexï¼›å¦åˆ™åˆ™ä¸ç”¨ç§»åŠ¨ã€‚")])])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react-reconciler/src/ReactChildFiber.new.js ç®€åŒ–çš„æ ¸å¿ƒé€»è¾‘")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reconcileChildrenArray")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("returnFiber")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// currentFirstChild çš„çˆ¶çº§ fiber èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("currentFirstChild")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å‰æ‰§è¡Œæ›´æ–°ä»»åŠ¡çš„ fiber èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("newChildren")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Array"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç»„ä»¶çš„ render æ–¹æ³•æ¸²æŸ“å‡ºçš„æ–°çš„ ReactElement èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("lanes")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Lanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("resultingFirstChild")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("previousNewFiber")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentFirstChild"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextOldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastPlacedIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å·²å¤„ç†èŠ‚ç‚¹çš„æœ€å¤§æ—§ç´¢å¼•")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆæ¬¡æ¸²æŸ“ï¼ˆfalseï¼‰è¿˜æ˜¯æ›´æ–°ï¼ˆtrueï¼‰")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" shouldTrackSideEffects "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.ä»å¤´å¼€å§‹éå† newChildren ï¼Œé€ä¸ªä¸ oldFiber é“¾ä¸­çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­ DOM èŠ‚ç‚¹æ˜¯å¦å¯å¤ç”¨")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç¬¬ä¸€è½®éå†å®Œæ¯•åï¼Œä¼šæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.1 newChildren ä¸ oldFiber åŒæ—¶éå†å®ŒğŸ‘‡")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" newIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" newChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" newIdx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      nextOldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–ä¸‹ä¸€ä¸ªæ—§èŠ‚ç‚¹")]),t._v("\n      nextOldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç”Ÿæˆæ–°çš„èŠ‚ç‚¹ï¼Œåˆ¤æ–­ key ä¸ type æ˜¯å¦ç›¸åŒå°±åœ¨ updateSlot ä¸­")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åªæœ‰ key å’Œ type éƒ½ç›¸åŒæ‰ä¼šå¤ç”¨ oldFiber èŠ‚ç‚¹")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateSlot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      oldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      newChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      lanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.1.1 key ä¸åŒï¼ŒnewFiber ä¼šä¸º null ï¼Œç›´æ¥è·³å‡ºå¾ªç¯ï¼Œç¬¬ä¸€è½®éå†ç»“æŸ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextOldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.1.2 key ç›¸åŒï¼Œä½†æ˜¯ type ä¸åŒçš„æƒ…å†µï¼Œå°† oldFiber æ‰“ä¸Š Deletion çš„æ ‡è®°ï¼Œå¾ªç¯ç»§ç»­")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shouldTrackSideEffects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.1.3 è®°å½•æœ€åä¸€ä¸ªå¯å¤ç”¨çš„èŠ‚ç‚¹åœ¨ oldFiber ä¸­çš„ä½ç½®ç´¢å¼•")]),t._v("\n    lastPlacedIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("placeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lastPlacedIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è°ƒæ•´æŒ‡é’ˆ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("previousNewFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      resultingFirstChild "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      previousNewFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    previousNewFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextOldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.2 newChildren éå†å®Œï¼ŒoldFiber æ²¡éå†å®Œï¼Œéå†å‰©ä¸‹çš„ oldFiber å¹¶æ ‡è®°ä¸º Deletion")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" newChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteRemainingChildren")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resultingFirstChild"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.3 newChildren æ²¡éå†å®Œï¼ŒoldFiber éå†å®Œ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿™è¯´æ˜ newChildren ä¸­å‰©ä¸‹çš„èŠ‚ç‚¹éƒ½æ˜¯æ–°æ’å…¥çš„èŠ‚ç‚¹ï¼Œåªéœ€éå†å‰©ä¸‹çš„ newChildren åˆ›å»ºæ–°çš„ Fiber èŠ‚ç‚¹å¹¶ä»¥æ­¤æ ‡è®°ä¸º Placement")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éå†å‰©ä½™çš„ newChildren")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" newIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" newChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" newIdx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºæ–°çš„ Fiber èŠ‚ç‚¹")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†æ–°çš„ Fiber èŠ‚ç‚¹æ ‡è®°ä¸º Placement")]),t._v("\n      lastPlacedIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("placeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lastPlacedIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†æ–°çš„ Fiber èŠ‚ç‚¹ç”¨ sibling æŒ‡é’ˆè¿æ¥æˆé“¾è¡¨")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("previousNewFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        resultingFirstChild "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        previousNewFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      previousNewFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿”å›æ–°çš„ Fiber èŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨çš„å¤´éƒ¨èŠ‚ç‚¹")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resultingFirstChild"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.4 newChildren ä¸ oldFiber éƒ½æ²¡éå†å®Œï¼Œè¿™æ˜¯ Diff ç®—æ³•æœ€éš¾çš„éƒ¨åˆ†ã€‚")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æœ‰å¯èƒ½å­˜åœ¨ç§»åŠ¨äº†ä½ç½®çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸ºäº†å¿«é€Ÿåœ°æ‰¾åˆ° oldFiber ä¸­å¯ä»¥å¤ç”¨çš„èŠ‚ç‚¹ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªä»¥ oldFiber çš„ key ä¸º key ï¼ŒoldFiber ä¸º value çš„ Map æ•°æ®ç»“æ„ã€‚")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" existingChildren "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapRemainingChildren")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éå†å‰©ä½™çš„ newChildren ï¼Œé€ä¸ªåœ¨ map ä¸­å¯»æ‰¾ oldFiber ä¸­å¯å¤ç”¨çš„èŠ‚ç‚¹ã€‚")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæ‰¾åˆ°å¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œåˆ™å°† oldIndex ä¸ lastPlacedIndex æ¯”è¾ƒã€‚")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœ oldIndex ä¸ lastPlacedIndex å°ï¼Œåˆ™è¯¥èŠ‚ç‚¹éœ€è¦å³ç§»ï¼Œå°†æ–°çš„ Fiber èŠ‚ç‚¹æ ‡è®°ä¸º Placement ã€‚å¦åˆ™ï¼Œå°† lastPlacedIndex æ›´æ–°ä¸º oldIndex ã€‚")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éå† newChildrenï¼Œåœ¨ map ä¸­æŸ¥æ‰¾åœ¨ oldFiber ä¸­å¯å¤ç”¨çš„èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" newIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" newChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" newIdx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateFromMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      existingChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      newChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      lanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰¾åˆ°äº†å¯å¤ç”¨çš„ Fiber èŠ‚ç‚¹ï¼Œå°†å…¶ä» map ä¸­åˆ é™¤ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹å·²ç»è¢«å¤ç”¨äº†")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shouldTrackSideEffects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          existingChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" newIdx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ›´æ–°æœ€åä¸€ä¸ªå¯å¤ç”¨èŠ‚ç‚¹èŠ‚ç‚¹çš„ä½ç½®ç´¢å¼•")]),t._v("\n      lastPlacedIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("placeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lastPlacedIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newIdx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°† newFiber ç”¨ sibling è¿æ¥æˆå•é“¾è¡¨")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("previousNewFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        resultingFirstChild "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        previousNewFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      previousNewFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éå†å®Œ newChildren åï¼Œè¿˜å­˜åœ¨ map åœ¨çš„èŠ‚ç‚¹å°±æ˜¯å‰©ä½™çš„èŠ‚ç‚¹ï¼Œéœ€è¦æ ‡è®°ä¸ºåˆ é™¤ï¼ˆDeletionï¼‰")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shouldTrackSideEffects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    existingChildren"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("child")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" child"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿”å›æ–°çš„ fiber é“¾è¡¨")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resultingFirstChild"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("https://juejin.cn/post/7131741751152214030")]),t._v(" "),s("p",[t._v("https://juejin.cn/post/7318446267033452570")]),t._v(" "),s("p",[t._v("Fiber ç»“æ„ï¼š")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FiberNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" WorkTag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  pendingProps"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mixed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TypeOfMode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Instance")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¡¨ç¤ºèŠ‚ç‚¹ç±»å‹çš„æ ‡è®°ï¼Œä¾‹å¦‚ FunctionComponent ã€ClassComponent ç­‰ã€‚")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elementType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Fiber")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘è¯¥ FiberNode çš„çˆ¶èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘è¯¥ FiberNode çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘å³è¾¹ç¬¬ä¸€ä¸ªå…„å¼Ÿ Fiber èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å‰èŠ‚ç‚¹åœ¨çˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„ç´¢å¼•")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ref "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å­˜å‚¨ FiberNode çš„å¼•ç”¨ä¿¡æ¯ï¼Œä¸ React çš„ Ref æœ‰å…³")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pendingProps "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pendingProps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memoizedProps "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateQueue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memoizedState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dependencies "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Effects")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoFlags"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lanes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoLanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childLanes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NoLanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// çœç•¥ä¸€äº›æ— å…³çš„å±æ€§...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"ä¸€ä¸ªä¾‹å­"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ä¸ªä¾‹å­"}},[t._v("#")]),t._v(" ä¸€ä¸ªä¾‹å­")]),t._v(" "),s("p",[t._v("æ—§åˆ—è¡¨: [A, B, C, D] â†’ æ–°åˆ—è¡¨ [A, C, B, E]")]),t._v(" "),s("ul",[s("li",[t._v("Vue2 çš„å¤„ç†è¿‡ç¨‹")])]),t._v(" "),s("p",[t._v("åŒç«¯æŒ‡é’ˆä¸å››ç§é…å¯¹ï¼Œå°è¯•å¤´å¤´ã€å°¾å°¾ã€æ—§å¤´æ–°å°¾ã€æ—§å°¾æ–°å¤´å››ç§å¿«é€Ÿå‘½ä¸­ï¼Œæœ€ååˆ©ç”¨æ—§èŠ‚ç‚¹æ˜ å°„åºåˆ—è¿›è¡Œæ˜ å°„æŸ¥æ‰¾ï¼ŒåŒ¹é…åˆ°çš„æ—§èŠ‚ç‚¹ï¼ˆå³å¯è¢«å¤ç”¨èŠ‚ç‚¹ï¼‰ç§»åˆ°OldStartæŒ‡é’ˆå‰ã€‚")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("æ­¥éª¤1: ä½¿ç”¨åŒç«¯æ¯”è¾ƒï¼Œå¤´å¤´æ¯”è¾ƒ\nA "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" A âœ“ åŒ¹é…ï¼Œä¸¤ä¸ªæŒ‡é’ˆéƒ½åç§»\nå‰©ä½™ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("B, C, D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" vs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("C, B, E"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\næ­¥éª¤2: å››ç§é…å¯¹éƒ½ä¸å‘½ä¸­ï¼Œèµ°æ˜ å°„æŸ¥æ‰¾ï¼Œç”¨æ–°èŠ‚ç‚¹å»åŒ¹é…æ—§èŠ‚ç‚¹mapï¼ŒåŒ¹é…åˆ°çš„æ—§èŠ‚ç‚¹ç§»åˆ°OldStartæŒ‡é’ˆå‰\næŒ‡   é’ˆï¼šoldStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" B "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", newStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" C "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\næ¯”è¾ƒå››é¡¹ï¼šBâ‰ C, Dâ‰ E, Bâ‰ E, Dâ‰ C\næ˜    å°„ï¼šnewStart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" åŒ¹é…ä¸Šäº† æ—§æ˜ å°„ Index "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("ï¼Œ\n        ç§»åŠ¨è¿™ä¸ªæ—§èŠ‚ç‚¹ C åˆ° oldStart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" å‰é¢ï¼ŒinsertBefore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent, C.el, B.el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nå¤„ç†æ ‡è®°ï¼šæ—§æ•°ç»„ä½ç½® "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" ç½®ä¸ºå ä½ï¼ˆå¦‚ undefinedï¼‰ï¼ŒnewStartIdx++\nDOM å˜ä¸º "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A, C, B, D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n\næ­¥éª¤3ï¼šå¤´å¤´å†æ¬¡åŒ¹é…\næŒ‡   é’ˆï¼š oldStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" B "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", newStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" B "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\næ¯”è¾ƒå››é¡¹ï¼š "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("B")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("B\nåŠ¨   ä½œï¼šå¤ç”¨/patch Bï¼ŒæŒ‡é’ˆå‰ç§»\n\næ­¥éª¤4ï¼šå››ç§é…å¯¹ä»ä¸å‘½ä¸­ï¼ŒæŸ¥æ˜ å°„æœªæ‰¾åˆ°\næŒ‡    é’ˆï¼šæŒ‡é’ˆæ¨è¿›ä¼šè·³è¿‡æ—§æ•°ç»„ä¸­çš„å ä½é¡¹ï¼ˆidx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" å¤„æ˜¯å·²ç§»åŠ¨çš„ Cï¼‰ï¼ŒoldStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" D "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", newStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" E "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\næ¯”è¾ƒå››é¡¹ï¼šDâ‰ Eã€Dâ‰ Eï¼ˆå°¾å°¾ï¼‰ç­‰\næ˜    å°„ï¼šæ—§åˆ—è¡¨ä¸­æ²¡æœ‰ E\nåŠ¨   ä½œï¼šåˆ›å»ºæ–°èŠ‚ç‚¹ E å¹¶æ’å…¥åˆ°æœªå¤„ç†çª—å£çš„æœ€å‰æ–¹ï¼ˆä»¥ oldStart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ä¸ºé”šï¼‰ï¼ŒinsertBefore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent, E.el, D.el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nDOM æš‚æ—¶å˜ä¸º "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A, C, B, E, D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ã€‚\n\næ­¥éª¤5ï¼šæ¸…ç†å‰©ä½™æ—§èŠ‚ç‚¹\næŒ‡   é’ˆï¼šnewStartIdx++ è¶Šç•Œç»“æŸä¸»å¾ªç¯ï¼ˆnewStartIdx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("newEndIdx")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("ï¼‰\næ–°åˆ—è¡¨å·²å¤„ç†å®Œï¼Œæ—§åˆ—è¡¨è¿˜æœ‰ D æœªè¢«å¤ç”¨\nåŠ¨ä½œï¼šç§»é™¤æ—§èŠ‚ç‚¹ D\nDOM æœ€ç»ˆå˜ä¸º "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A, C, B, E"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ï¼ˆä¸æ–°åˆ—è¡¨ä¸€è‡´ï¼‰\n\næ€»ç»“ï¼šåªéœ€è¦ç§»åŠ¨Dï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½ä¸åŠ¨\n")])])]),s("ul",[s("li",[t._v("Vue3 çš„å¤„ç†è¿‡ç¨‹\nå…ˆåˆ©ç”¨åŒç«¯æ¯”è¾ƒå¯¹é½å…¬å…±å‰åç¼€ï¼Œç„¶åå¯¹æœªçŸ¥åŒºé—´æ„å»º keyâ†’index æ˜ å°„ï¼Œå¡«å…… newIndexToOldIndexMapï¼Œè®¡ç®— LISï¼Œæœ€åä»å³å¾€å·¦éå†æ–°åºåˆ—æ‰§è¡Œæ’å…¥å’Œç§»åŠ¨ã€‚")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("æ­¥éª¤1ï¼šåŒæ­¥å¤´éƒ¨å…¬å…±å‰ç¼€\n  - ç›¸åŒå‰ç¼€ï¼Œæ— ç›¸åŒåç¼€ï¼Œä¸­é—´ä¹±åºï¼š"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("B,C,D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" -"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("C, B, E"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("ï¼Œæ­¤æ—¶i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\næ­¥éª¤2ï¼šç”¨æ–°æœªçŸ¥åŒºé—´æ„å»ºæ˜ å°„ï¼Œç„¶åæ‰«éå†æ—§åˆ—è¡¨ï¼Œè®°å½•æ–°èŠ‚ç‚¹åœ¨æ—§åˆ—è¡¨ä¸­çš„ç´¢å¼•ï¼ˆ0è¡¨ç¤ºæ–°å¢ï¼‰\n  - æ–°æœªçŸ¥åŒºé—´ keyâ†’indexï¼š "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" C:1, B:2, E:3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  - æ‰«ææ—§ï¼š\n    - C å‘½ä¸­æ–°ç´¢å¼• "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ï¼Œè®°å½•å¹¶ patch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("ï¼Œè®°å½•è‡³newIndexToOldIndexMap\n    - B å‘½ä¸­æ–°ç´¢å¼• "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" ï¼Œè®°å½•å¹¶ patch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("ï¼Œè®°å½•è‡³newIndexToOldIndexMap\n    - D æœªå‘½ä¸­ï¼Œæ‰§è¡Œå¸è½½ï¼ˆ remove"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ï¼‰  \n  - æŒ‰ æ–°æœªçŸ¥åŒºé—´é¡ºåº å¾—åˆ°æ—§ç´¢å¼•åºåˆ—ï¼ŒnewIndexToOldIndexMap ç±»ä¼¼ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("+1, oldIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("+1, E-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\næ­¥éª¤3ï¼šè®¡ç®— LIS\n  - æ–°èŠ‚ç‚¹ key æ˜ å°„newIndexToOldIndexMapï¼Œå³æŒ‰æ–°æœªçŸ¥åŒºé—´é¡ºåºå¾—åˆ°æ—§ç´¢å¼•åºåˆ—ï¼ˆ0 åŸºï¼‰ï¼š "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Câ†’2, Bâ†’1, Eâ†’æœªå‘½ä¸­"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  - newIndexToOldIndexMap ç±»ä¼¼ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("+1, oldIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("+1, E-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  - éé›¶éƒ¨åˆ† "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" çš„ LIS é•¿åº¦ä¸º "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(",ä¿ç•™å…¶ä¸­ä¸€ä¸ªï¼ˆå¸¸è§æ˜¯ä¿ç•™ B ï¼‰ï¼Œæ„å‘³ç€ C éœ€è¦ç§»åŠ¨ã€‚\n  \næ­¥éª¤4ï¼šä»å³å‘å·¦æŒ‰æ–°åºæ‰§è¡Œæ’å…¥/ç§»åŠ¨\n  - "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("j")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("ï¼Œæ–°èŠ‚ç‚¹ E æœªå‘½ä¸­ï¼ˆå€¼ä¸º "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("ï¼‰ï¼Œéœ€è¦åˆ›å»º\n    - é”šç‚¹ anchor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" new"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("j+1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("?.el ä¸å­˜åœ¨ï¼Œç­‰ä»·äºåˆ›å»ºè¿½åŠ åˆ°æœ«å°¾\n    - insertBefore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent, E.el, null"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" â†’ DOMï¼š "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A, B, C, E"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  - "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("j")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("ï¼Œæ–°èŠ‚ç‚¹ B åœ¨ LISï¼Œè·³è¿‡ï¼Œä¸ç§»åŠ¨\n  - "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("j")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("ï¼Œæ–°èŠ‚ç‚¹ C ä¸åœ¨ LISï¼Œéœ€è¦ç§»åŠ¨åˆ°é”šç‚¹ B ä¹‹å‰\n    - é”šç‚¹ anchor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" B.el\n    - insertBefore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent, C.el, B.el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" â†’ DOMï¼š "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A, C, B, E"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("ul",[s("li",[t._v("React çš„å¤„ç†è¿‡ç¨‹\nåŒå±‚æ¯”è¾ƒï¼Œkey + type ç›¸åŒåˆ™å¤ç”¨ï¼›æ•°ç»„æ–° children èµ° O(n) æ‰«æï¼Œä¸è®¡ç®— LISï¼Œç”¨ lastPlacedIndex åˆ¤å®šæ˜¯å¦ç§»åŠ¨ï¼Œå°äºlastPlacedIndex åˆ™ç§»åŠ¨ã€‚")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("æ­¥éª¤1ï¼šçº¿æ€§éå†æ–°èŠ‚ç‚¹åˆ—è¡¨ï¼Œé€ä¸ªä¸ oldFiber é“¾ä¸­çš„èŠ‚ç‚¹å¯¹æ¯”\n  - å¤ç”¨/patch A ï¼› lastPlacedIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" ã€‚\n  - æœªçŸ¥åŒºé—´ï¼šæ—§ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("B, C, D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ï¼Œæ–° "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("C, B, E"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ã€‚ \n\næ­¥éª¤2: æ„å»ºæ—§èŠ‚ç‚¹ keyâ†’fiber æ˜ å°„ï¼Œéå†æ–°æœªçŸ¥åŒºé—´ï¼Œé€šè¿‡keyç­›é€‰å¯å¤ç”¨èŠ‚ç‚¹\n  - æ—§æœªçŸ¥åŒºé—´ keyâ†’fiberï¼š"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" B:fiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", C:fiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", D:fiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  - éå†æ–°æœªçŸ¥åŒºé—´ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("C, B, E"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("ï¼Œæ£€æŸ¥åœ¨æ—§èŠ‚ç‚¹mapä¸­æ˜¯å¦å­˜åœ¨åŒkeyèŠ‚ç‚¹å¯ä»¥åŒ¹é…å¤ç”¨\n    - C å‘½ä¸­æ—§èŠ‚ç‚¹ Cï¼Œ æ—§ç´¢å¼• "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" â‰¥ lastPlacedIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" â†’ ä¸ç§»åŠ¨ï¼Œæ›´æ–° "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("lastPlacedIndex")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" ã€‚\n    - B å‘½ä¸­æ—§èŠ‚ç‚¹ Bï¼Œ æ—§ç´¢å¼• "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" lastPlacedIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" â†’ å‘å³ç§»åŠ¨ï¼Œæ›´æ–° "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("lastPlacedIndex")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" ã€‚\n    - E æœªå‘½ä¸­ï¼Œåˆ›å»ºå¹¶æ ‡è®° Placementã€‚\n  - æ–°æœªçŸ¥åŒºé—´éå†å®Œï¼Œåˆ é™¤æ—§æœªçŸ¥åŒºé—´ä¸­æœªå‘½ä¸­èŠ‚ç‚¹ D\n\næ­¥éª¤3: æäº¤é˜¶æ®µæ”¾ç½®\n  - æ ¹æ®æ ‡è®°æ‰§è¡Œæ’å…¥/ç§»åŠ¨ã€‚\n  - B å› ä¸ºéœ€è¦ç§»åŠ¨ï¼Œæ’å…¥åˆ°æ­£ç¡®é”šç‚¹ä¹‹å‰ï¼ˆé”šç‚¹ç”± getHostSibling è®¡ç®—ï¼Œç¡®ä¿æœ€ç»ˆé¡ºåºä¸æ–°åº\n  - E ä½œä¸ºæ–°å»ºé€šå¸¸è¿½åŠ åˆ°æœ«å°¾ã€‚\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);